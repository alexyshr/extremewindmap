<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>D Database Storing | Spatio-temporal analysis of extreme wind velocities for infrastructure design</title>
  <meta name="description" content="D Database Storing | Spatio-temporal analysis of extreme wind velocities for infrastructure design" />
  <meta name="generator" content="bookdown 0.18 and GitBook 2.6.7" />

  <meta property="og:title" content="D Database Storing | Spatio-temporal analysis of extreme wind velocities for infrastructure design" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="D Database Storing | Spatio-temporal analysis of extreme wind velocities for infrastructure design" />
  
  
  

<meta name="author" content="Alexys Herleym Rodríguez Avellaneda" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="C-datadownload.html"/>
<link rel="next" href="E-docrcode.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/kePrint-0.0.1/kePrint.js"></script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

true

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Spatio-temporal analysis of extreme wind velocities for infrastructure design</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="dbstoring" class="section level1">
<h1><span class="header-section-number">D</span> Database Storing</h1>
<p>To optimize memory usage when running R code, some information related to IDEAM and ISD data sources, like stations and wind time series, were stored in <strong>PostgreSQL database</strong>, thanks to the possibility of lazy evaluation with <strong>tidyverse</strong> R package <code>dplyr</code>, see <span class="citation">(Wickham, <a href="references.html#ref-Wickham2014" role="doc-biblioref">2014</a>)</span>, and <span class="citation">(Wickham et al., <a href="references.html#ref-Wickham2019" role="doc-biblioref">2019</a>)</span>, which do not load the entire dataset in memory from the beginning, this is, <em>“it delays the actual operation until necessary and loads data onto R from the database only when we need it”</em> <span class="citation">(Berhane, <a href="references.html#ref-databasesinr" role="doc-biblioref">2016</a>)</span>. In parallel, it was used throughout the investigation, the <strong>tidyverse</strong> R package <code>tibble</code>, which allow lazy and surly data-frames in R, namely <em>“they do less …, and complain more”</em> <span class="citation">(Müller &amp; Wickham, <a href="references.html#ref-Mueller2019" role="doc-biblioref">2019</a>)</span>. As a reference, there is an R package called <code>tidyverse</code>, which installs and loads all related packages (<code>ggplot2</code>, <code>tibble</code>, <code>tidyr</code>, <code>readr</code>, and <code>dplyr</code>), see <span class="citation">(Wickham, <a href="references.html#ref-Wickham2019a" role="doc-biblioref">2019</a>)</span>, and <span class="citation">(Wickham, Averick, et al., <a href="references.html#ref-Wickham2019b" role="doc-biblioref">2019</a>)</span>.</p>
<div id="loading-time-series-from-text-files-to-postgresql" class="section level2">
<h2><span class="header-section-number">D.1</span> Loading Time Series from Text Files to PostgreSQL</h2>
<p>R Package <code>dplyr</code> can be used to load data-frames created with text files, to tables inside databases, using for instance, <code>copy_to</code> function, see <span class="citation">(Berhane, <a href="references.html#ref-databasesinr" role="doc-biblioref">2016</a>)</span>, nonetheless an alternative procedure was done with <em>MS-DOS</em> commands, and <em>SQL</em> scripts using <em>pgsql</em> (terminal-based front-end to PostgreSQL). This procedure is described below for IDEAM data VV_AUT_10 - instantaneous wind velocity each ten (10) minutes, see Table <a href="2-rmd-data.html#tab:tabledatasources2">2.2</a>.</p>
<p>There is one text file for each station time series in VV_AUT_10. There are a total of 204 stations, that is 204 files. The file name follows the format <em>VV_AUT_10@*.data</em>, where * is replaced by the station identifier, as can be seen below.</p>


<div class="sourceCode" id="cb7"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb7-1" title="1">      <span class="ex">VV_AUT_10@31095030.data</span></a>
<a class="sourceLine" id="cb7-2" title="2">      <span class="ex">VV_AUT_10@29065130.data</span></a>
<a class="sourceLine" id="cb7-3" title="3">      <span class="ex">VV_AUT_10@29065140.data</span></a>
<a class="sourceLine" id="cb7-4" title="4">      <span class="ex">...</span></a></code></pre></div>

<p>Below is the partial content of a time series file (VV_AUT_10@31095030.data). It has two columns (Fecha and Valor) separated by character |.</p>


<div class="sourceCode" id="cb8"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb8-1" title="1">      <span class="ex">Fecha</span><span class="kw">|</span><span class="ex">Valor</span></a>
<a class="sourceLine" id="cb8-2" title="2">      <span class="ex">2008-10-29</span> 10:30:00<span class="kw">|</span><span class="ex">0.9</span></a>
<a class="sourceLine" id="cb8-3" title="3">      <span class="ex">2008-10-29</span> 10:40:00<span class="kw">|</span><span class="ex">1.4</span></a>
<a class="sourceLine" id="cb8-4" title="4">      <span class="ex">2008-10-29</span> 10:50:00<span class="kw">|</span><span class="ex">1.2</span></a>
<a class="sourceLine" id="cb8-5" title="5">      <span class="ex">2008-10-29</span> 11:00:00<span class="kw">|</span><span class="ex">1.5</span></a>
<a class="sourceLine" id="cb8-6" title="6">      <span class="ex">...</span></a></code></pre></div>

<ol style="list-style-type: decimal">
<li><p>Install PostgreSQL 10.5</p></li>
<li><p>Create database with next credentials</p></li>
</ol>
<table class="table" style="font-size: 8px; margin-left: auto; margin-right: auto;">
<caption style="font-size: initial !important;">
<span id="tab:unnamed-chunk-11">Table D.1: </span>PostgreSQL Database Credentials
</caption>
<thead>
<tr>
<th style="text-align:left;text-align: left;">
Credential
</th>
<th style="text-align:left;text-align: left;">
Value
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;width: 0.8in; ">
dbname
</td>
<td style="text-align:left;width: 0.8in; ">
winddata
</td>
</tr>
<tr>
<td style="text-align:left;width: 0.8in; ">
host
</td>
<td style="text-align:left;width: 0.8in; ">
localhost
</td>
</tr>
<tr>
<td style="text-align:left;width: 0.8in; ">
pot
</td>
<td style="text-align:left;width: 0.8in; ">
5432
</td>
</tr>
<tr>
<td style="text-align:left;width: 0.8in; ">
user
</td>
<td style="text-align:left;width: 0.8in; ">
user1
</td>
</tr>
<tr>
<td style="text-align:left;width: 0.8in; ">
password
</td>
<td style="text-align:left;width: 0.8in; ">
user1
</td>
</tr>
</tbody>
</table>


<div class="sourceCode" id="cb9"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb9-1" title="1">        <span class="co">-- Database: winddata</span></a>
<a class="sourceLine" id="cb9-2" title="2">        <span class="co">-- DROP DATABASE winddata;</span></a>
<a class="sourceLine" id="cb9-3" title="3">        <span class="kw">CREATE</span> <span class="kw">DATABASE</span> winddata</a>
<a class="sourceLine" id="cb9-4" title="4">            <span class="kw">WITH</span> </a>
<a class="sourceLine" id="cb9-5" title="5">            OWNER <span class="op">=</span> user1</a>
<a class="sourceLine" id="cb9-6" title="6">            ENCODING <span class="op">=</span> <span class="st">&#39;UTF8&#39;</span></a>
<a class="sourceLine" id="cb9-7" title="7">            LC_COLLATE <span class="op">=</span> <span class="st">&#39;English_United States.1252&#39;</span></a>
<a class="sourceLine" id="cb9-8" title="8">            LC_CTYPE <span class="op">=</span> <span class="st">&#39;English_United States.1252&#39;</span></a>
<a class="sourceLine" id="cb9-9" title="9">            <span class="kw">TABLESPACE</span> <span class="op">=</span> pg_default</a>
<a class="sourceLine" id="cb9-10" title="10">            CONNECTION <span class="kw">LIMIT</span> <span class="op">=</span> <span class="op">-</span><span class="dv">1</span>;</a></code></pre></div>

<ol start="3" style="list-style-type: decimal">
<li>Inside PostgreSQL create <em>Temp</em> table with the following SQL code. This table will temporarily store the information of each station text file.</li>
</ol>


<div class="sourceCode" id="cb10"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb10-1" title="1">        <span class="kw">CREATE</span> <span class="kw">TABLE</span> <span class="kw">public</span>.<span class="ot">&quot;TEMP&quot;</span> (</a>
<a class="sourceLine" id="cb10-2" title="2">          txtfecha <span class="dt">VARCHAR</span>(<span class="dv">30</span>),</a>
<a class="sourceLine" id="cb10-3" title="3">          valor <span class="dt">NUMERIC</span>(<span class="dv">6</span>,<span class="dv">2</span>) ) <span class="kw">WITH</span> (oids <span class="op">=</span> <span class="kw">false</span>);</a>
<a class="sourceLine" id="cb10-4" title="4">        </a>
<a class="sourceLine" id="cb10-5" title="5">        <span class="kw">ALTER</span> <span class="kw">TABLE</span> <span class="kw">public</span>.<span class="ot">&quot;TEMP&quot;</span></a>
<a class="sourceLine" id="cb10-6" title="6">          OWNER <span class="kw">TO</span> user1;</a></code></pre></div>

<ol start="4" style="list-style-type: decimal">
<li>Inside PostgreSQL create <em>VV_AUT_10</em> table with following SQL code. This table will permanently store, one under the other, the content of all files with time series (204 files), identifying with an additional column the station ID of each record.</li>
</ol>


<div class="sourceCode" id="cb11"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb11-1" title="1">        <span class="kw">CREATE</span> <span class="kw">TABLE</span> <span class="kw">public</span>.<span class="ot">&quot;VV_AUT_10&quot;</span> (</a>
<a class="sourceLine" id="cb11-2" title="2">          <span class="kw">id</span> BIGSERIAL,</a>
<a class="sourceLine" id="cb11-3" title="3">          estationid BIGINT,</a>
<a class="sourceLine" id="cb11-4" title="4">          txtfecha <span class="dt">VARCHAR</span>(<span class="dv">30</span>),</a>
<a class="sourceLine" id="cb11-5" title="5">          valor <span class="dt">NUMERIC</span>(<span class="dv">6</span>,<span class="dv">2</span>),</a>
<a class="sourceLine" id="cb11-6" title="6">          <span class="ot">&quot;timestamp&quot;</span> <span class="dt">TIMESTAMP</span>(<span class="dv">0</span>) <span class="kw">WITHOUT</span> <span class="dt">TIME</span> <span class="dt">ZONE</span> ) <span class="kw">WITH</span> (oids <span class="op">=</span> <span class="kw">false</span>);</a>
<a class="sourceLine" id="cb11-7" title="7">        </a>
<a class="sourceLine" id="cb11-8" title="8">        <span class="kw">ALTER</span> <span class="kw">TABLE</span> <span class="kw">public</span>.<span class="ot">&quot;VV_AUT_10&quot;</span></a>
<a class="sourceLine" id="cb11-9" title="9">          OWNER <span class="kw">TO</span> user1;</a></code></pre></div>

<ol start="5" style="list-style-type: decimal">
<li>Use next MS-DOS script that will take files content and load them into the database, temporarily to <em>Temp</em>, then to <em>VV_AUT_10</em>.</li>
</ol>


<div class="sourceCode" id="cb12"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb12-1" title="1">      <span class="ex">REM</span> 1: consecutive id</a>
<a class="sourceLine" id="cb12-2" title="2">      <span class="ex">REM</span> 2: file name</a>
<a class="sourceLine" id="cb12-3" title="3">      <span class="ex">REM</span> 3: station id</a>
<a class="sourceLine" id="cb12-4" title="4">      <span class="bu">echo</span> --(%1 of 204)<span class="op">&gt;&gt;</span><span class="st">&quot;load_vv_aut_10.logdos&quot;</span></a>
<a class="sourceLine" id="cb12-5" title="5">      <span class="bu">echo</span> --(%1 of 204)</a>
<a class="sourceLine" id="cb12-6" title="6">      <span class="bu">echo</span> Empty table TEMP</a>
<a class="sourceLine" id="cb12-7" title="7">      <span class="bu">echo</span> psql -L <span class="st">&quot;load_vv_aut_10.logquery&quot;</span> -c <span class="st">&quot;DELETE FROM public.</span><span class="dt">\&quot;</span><span class="st">TEMP</span><span class="dt">\&quot;</span><span class="st">&quot;</span> </a>
<a class="sourceLine" id="cb12-8" title="8">       <span class="st">&quot;postgresql://user1:user1@127.0.0.1/winddata&quot;</span> <span class="op">&gt;&gt;</span><span class="st">&quot;load_vv_aut_10.logdos&quot;</span></a>
<a class="sourceLine" id="cb12-9" title="9">      <span class="ex">psql</span> -L <span class="st">&quot;load_vv_aut_10.logquery&quot;</span> -c <span class="st">&quot;DELETE FROM public.</span><span class="dt">\&quot;</span><span class="st">TEMP</span><span class="dt">\&quot;</span><span class="st">&quot;</span> </a>
<a class="sourceLine" id="cb12-10" title="10">       <span class="st">&quot;postgresql://user1:user1@127.0.0.1/winddata&quot;</span> <span class="op">&gt;&gt;</span><span class="st">&quot;load_vv_aut_10.logdos&quot;</span></a>
<a class="sourceLine" id="cb12-11" title="11">      <span class="bu">echo</span> Copy from FILE to TEMP</a>
<a class="sourceLine" id="cb12-12" title="12">      <span class="bu">echo</span> psql -L <span class="st">&quot;load_vv_aut_10.logquery&quot;</span> -c <span class="st">&quot;COPY public.</span><span class="dt">\&quot;</span><span class="st">TEMP</span><span class="dt">\&quot;</span><span class="st"> FROM &#39;modified\%2&#39; </span></a>
<a class="sourceLine" id="cb12-13" title="13"><span class="st">       (FORMAT CSV, DELIMITER&#39;|&#39;, HEADER)&quot;</span> <span class="st">&quot;postgresql://postgres:postgres@127.0.0.1/winddata&quot;</span></a>
<a class="sourceLine" id="cb12-14" title="14">       <span class="op">&gt;&gt;</span><span class="st">&quot;load_vv_aut_10.logdos&quot;</span></a>
<a class="sourceLine" id="cb12-15" title="15">      <span class="ex">psql</span> -L <span class="st">&quot;load_vv_aut_10.logquery&quot;</span> -c <span class="st">&quot;COPY public.</span><span class="dt">\&quot;</span><span class="st">TEMP</span><span class="dt">\&quot;</span><span class="st"> FROM &#39;modified\%2&#39; </span></a>
<a class="sourceLine" id="cb12-16" title="16"><span class="st">       (FORMAT CSV, DELIMITER&#39;|&#39;, HEADER)&quot;</span> <span class="st">&quot;postgresql://postgres:postgres@127.0.0.1/winddata&quot;</span> </a>
<a class="sourceLine" id="cb12-17" title="17">       <span class="op">&gt;&gt;</span><span class="st">&quot;load_vv_aut_10.logdos&quot;</span></a>
<a class="sourceLine" id="cb12-18" title="18">      <span class="bu">echo</span> Insert from TEMP into VV_AUT_10</a>
<a class="sourceLine" id="cb12-19" title="19">      <span class="bu">echo</span> psql -L <span class="st">&quot;load_vv_aut_10.logquery&quot;</span> -c <span class="st">&quot;INSERT INTO public.</span><span class="dt">\&quot;</span><span class="st">VV_AUT_10</span><span class="dt">\&quot;</span><span class="st">(estationid, txtfecha, valor, </span></a>
<a class="sourceLine" id="cb12-20" title="20"><span class="st">       timestamp) SELECT %3, txtfecha, valor, TO_TIMESTAMP(txtfecha, &#39;YYYY-MM-DD HH24:MI:SS&#39;) FROM </span></a>
<a class="sourceLine" id="cb12-21" title="21"><span class="st">       public.</span><span class="dt">\&quot;</span><span class="st">TEMP</span><span class="dt">\&quot;</span><span class="st">&quot;</span> <span class="st">&quot;postgresql://postgres:postgres@127.0.0.1/winddata&quot;</span> <span class="op">&gt;&gt;</span><span class="st">&quot;load_vv_aut_10.logdos&quot;</span></a>
<a class="sourceLine" id="cb12-22" title="22">      <span class="ex">psql</span> -L <span class="st">&quot;load_vv_aut_10.logquery&quot;</span> -c <span class="st">&quot;INSERT INTO public.</span><span class="dt">\&quot;</span><span class="st">VV_AUT_10</span><span class="dt">\&quot;</span><span class="st">(estationid, txtfecha, valor, </span></a>
<a class="sourceLine" id="cb12-23" title="23"><span class="st">       timestamp) SELECT %3, txtfecha, valor, TO_TIMESTAMP(txtfecha, &#39;YYYY-MM-DD HH24:MI:SS&#39;) FROM</span></a>
<a class="sourceLine" id="cb12-24" title="24"><span class="st">       public.</span><span class="dt">\&quot;</span><span class="st">TEMP</span><span class="dt">\&quot;</span><span class="st">&quot;</span> <span class="st">&quot;postgresql://postgres:postgres@127.0.0.1/winddata&quot;</span> <span class="op">&gt;&gt;</span><span class="st">&quot;load_vv_aut_10.logdos&quot;</span></a>
<a class="sourceLine" id="cb12-25" title="25">      <span class="bu">echo</span> HECHO! <span class="op">&gt;&gt;</span><span class="st">&quot;load_vv_aut_10.logdos&quot;</span></a>
<a class="sourceLine" id="cb12-26" title="26">      <span class="bu">echo</span> HECHO!</a>
<a class="sourceLine" id="cb12-27" title="27">      <span class="bu">echo</span> .. <span class="op">&gt;&gt;</span><span class="st">&quot;load_vv_aut_10.logdos&quot;</span></a>
<a class="sourceLine" id="cb12-28" title="28">      <span class="bu">echo</span> ..</a>
<a class="sourceLine" id="cb12-29" title="29">      <span class="bu">echo</span> .<span class="op">&gt;&gt;</span><span class="st">&quot;load_vv_aut_10.logdos&quot;</span></a>
<a class="sourceLine" id="cb12-30" title="30">      <span class="bu">echo</span> .</a></code></pre></div>

<ol start="6" style="list-style-type: decimal">
<li><p>Copy previous MS-DOS commands into a text file called <em>load_vv_aut_10.bat</em>. To use this file three parameters need to be passed: 1) consecutive id, 2) file name, and 3) station id. All results (after call it) are stored in a log file named <em>load_vv_aut_10.logdos</em>. All SQL commands including the <em>pgsql</em> answer/result after code execution, are stored in a log file named <em>load_vv_aut_10.logquery</em>. The script, first, keep a consecutive record of the procedure inside the log file, second, empty the contents of the <em>Temp</em> table, then, copy from text file to table <em>Temp</em>, and finally, from <em>Temp</em> inserts into <em>VV_AUT_10</em>. In all script steps, detailed output logs are sent to files <em>load_vv_aut_10.logdos</em>, and <em>load_vv_aut_10.logquery</em>.</p></li>
<li><p>Call previous file using MS-DOS commands as shown below, where first parameters are a consecutive identifier, second is time series file name, and third one is the station identifier.</p></li>
</ol>


<div class="sourceCode" id="cb13"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb13-1" title="1">        <span class="ex">call</span> load_vv_aut_10.bat 1 VV_AUT_10_57025020.csv 57025020</a>
<a class="sourceLine" id="cb13-2" title="2">        <span class="ex">call</span> load_vv_aut_10.bat 2 VV_AUT_10_31095030.csv 31095030</a>
<a class="sourceLine" id="cb13-3" title="3">        <span class="ex">call</span> load_vv_aut_10.bat 3 VV_AUT_10_29065130.csv 29065130</a>
<a class="sourceLine" id="cb13-4" title="4">        <span class="ex">call</span> load_vv_aut_10.bat 4 VV_AUT_10_29065140.csv 29065140</a>
<a class="sourceLine" id="cb13-5" title="5">        <span class="ex">...</span></a></code></pre></div>

<p>Consider following recommendations</p>
<ul>
<li>All files (204 files representing time series and load_vv_aut_10.bat) need to be stored in same Windows folder, for instance, ‘c:\load_data’</li>
<li>Using Windows Command Prompt, use <em>cd</em> command to locate the terminal inside the folder</li>
</ul>


<div class="sourceCode" id="cb14"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb14-1" title="1">        <span class="ex">c</span>:</a>
<a class="sourceLine" id="cb14-2" title="2">        <span class="bu">cd</span> load_data</a></code></pre></div>

<ul>
<li>Use <em>call</em> command described in last step, once for each station time series file.</li>
<li>Review content of log file load_vv_aut_10.logdos, to detect and correct possible loading errors.</li>
</ul>
<p>Following ISD and IDEAM information were loaded to the database using previous procedure, see Table <a href="2-rmd-data.html#tab:tabledatasources2">2.2</a>:</p>
<ul>
<li>VV_AUT_10</li>
<li>ALL_VVMX_AUT_60</li>
<li>ISD_LITE</li>
</ul>
<p>The previously listed tables have <strong>stacked</strong> stations information, namely, with the same number of columns, the records of the first station occupy a certain number of rows, and the station identifier is repeated in each row, and below them, increasing the number of rows, the information of other stations is stored.</p>
<p>Stacked tables were transform to <strong>unstacked</strong> versions, namely, one column for each station identifier. Stacked table <em>ALL_VVMX_AUT_60</em> was transformed to unstacked table <em>IDEAM_VVMX_60</em>, using next chunk of SQL code.</p>


<div class="sourceCode" id="cb15"><pre class="sourceCode sql"><code class="sourceCode sql"><a class="sourceLine" id="cb15-1" title="1">    <span class="kw">CREATE</span> <span class="kw">table</span> ideam_vvmx_60 <span class="kw">AS</span></a>
<a class="sourceLine" id="cb15-2" title="2">    <span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> crosstab(</a>
<a class="sourceLine" id="cb15-3" title="3">    <span class="st">&#39;SELECT DISTINCT</span></a>
<a class="sourceLine" id="cb15-4" title="4"><span class="st">      timestamp,</span></a>
<a class="sourceLine" id="cb15-5" title="5"><span class="st">      estacionid,</span></a>
<a class="sourceLine" id="cb15-6" title="6"><span class="st">      valor</span></a>
<a class="sourceLine" id="cb15-7" title="7"><span class="st">    FROM </span></a>
<a class="sourceLine" id="cb15-8" title="8"><span class="st">      public.&quot;ALL_VVMX_AUT_60&quot; </span></a>
<a class="sourceLine" id="cb15-9" title="9"><span class="st">    ORDER BY timestamp, estacionid&#39;</span>,</a>
<a class="sourceLine" id="cb15-10" title="10">    <span class="st">&#39;SELECT DISTINCT</span></a>
<a class="sourceLine" id="cb15-11" title="11"><span class="st">      estacionid</span></a>
<a class="sourceLine" id="cb15-12" title="12"><span class="st">    FROM </span></a>
<a class="sourceLine" id="cb15-13" title="13"><span class="st">      public.&quot;ALL_VVMX_AUT_60&quot; </span></a>
<a class="sourceLine" id="cb15-14" title="14"><span class="st">    ORDER BY estacionid&#39;</span>)</a>
<a class="sourceLine" id="cb15-15" title="15">    <span class="kw">AS</span> ct(mydatetime <span class="dt">timestamp</span>, <span class="ot">&quot;11105020&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;11135030&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;12015100&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;12015110&quot;</span> <span class="dt">real</span>,</a>
<a class="sourceLine" id="cb15-16" title="16">     <span class="ot">&quot;13035501&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;13085050&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;14015080&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;15015120&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;15065180&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;15065190&quot;</span> <span class="dt">real</span>, </a>
<a class="sourceLine" id="cb15-17" title="17">     <span class="ot">&quot;15065501&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;15075150&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;15075501&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;15079010&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;15085050&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;16015110&quot;</span> <span class="dt">real</span>, </a>
<a class="sourceLine" id="cb15-18" title="18">     <span class="ot">&quot;16015120&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;16015130&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;16015501&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;16055120&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;17015010&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;17035010&quot;</span> <span class="dt">real</span>, </a>
<a class="sourceLine" id="cb15-19" title="19">     <span class="ot">&quot;21015030&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;21015040&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;21015050&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;21015060&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;21015070&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;21055070&quot;</span> <span class="dt">real</span>, </a>
<a class="sourceLine" id="cb15-20" title="20">     <span class="ot">&quot;21105030&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;21115010&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;21115170&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;21115180&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;21145080&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;21185090&quot;</span> <span class="dt">real</span>, </a>
<a class="sourceLine" id="cb15-21" title="21">     <span class="ot">&quot;21195160&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;21195170&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;21195190&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;21205012&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;21205710&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;21205791&quot;</span> <span class="dt">real</span>, </a>
<a class="sourceLine" id="cb15-22" title="22">     <span class="ot">&quot;21205910&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;21205940&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;21206280&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;21206600&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;21206790&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;21206920&quot;</span> <span class="dt">real</span>, </a>
<a class="sourceLine" id="cb15-23" title="23">     <span class="ot">&quot;21206930&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;21206940&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;21206950&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;21206960&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;21206980&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;21206990&quot;</span> <span class="dt">real</span>, </a>
<a class="sourceLine" id="cb15-24" title="24">     <span class="ot">&quot;21215150&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;21215160&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;21215170&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;21215180&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;21215190&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;21235030&quot;</span> <span class="dt">real</span>, </a>
<a class="sourceLine" id="cb15-25" title="25">     <span class="ot">&quot;21255160&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;21255170&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;22025040&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;22075050&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;23035030&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;23065180&quot;</span> <span class="dt">real</span>, </a>
<a class="sourceLine" id="cb15-26" title="26">     <span class="ot">&quot;23065190&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;23085260&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;23085270&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;23105060&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;23105070&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;23125160&quot;</span> <span class="dt">real</span>, </a>
<a class="sourceLine" id="cb15-27" title="27">     <span class="ot">&quot;23125170&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;23195190&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;23195230&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;23195240&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;23195502&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;24015110&quot;</span> <span class="dt">real</span>, </a>
<a class="sourceLine" id="cb15-28" title="28">     <span class="ot">&quot;24015380&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;24025090&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;24035360&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;24035370&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;24035380&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;24035390&quot;</span> <span class="dt">real</span>, </a>
<a class="sourceLine" id="cb15-29" title="29">     <span class="ot">&quot;24035410&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;24035430&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;24055070&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;24055080&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;25025000&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;25025002&quot;</span> <span class="dt">real</span>, </a>
<a class="sourceLine" id="cb15-30" title="30">     <span class="ot">&quot;25025030&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;25025280&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;25025340&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;25025350&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;25025360&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;25025380&quot;</span> <span class="dt">real</span>, </a>
<a class="sourceLine" id="cb15-31" title="31">     <span class="ot">&quot;26015010&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;26015030&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;26035090&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;26035100&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;26055100&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;26055110&quot;</span> <span class="dt">real</span>, </a>
<a class="sourceLine" id="cb15-32" title="32">     <span class="ot">&quot;26055120&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;26075120&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;26075150&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;26085160&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;26085170&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;26095320&quot;</span> <span class="dt">real</span>, </a>
<a class="sourceLine" id="cb15-33" title="33">     <span class="ot">&quot;26105240&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;26105250&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;26115090&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;26125061&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;26125290&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;26125300&quot;</span> <span class="dt">real</span>, </a>
<a class="sourceLine" id="cb15-34" title="34">     <span class="ot">&quot;26125710&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;26135290&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;26135300&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;26135310&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;26135320&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;26135330&quot;</span> <span class="dt">real</span>, </a>
<a class="sourceLine" id="cb15-35" title="35">     <span class="ot">&quot;26145090&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;26155220&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;26155230&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;26155240&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;26185030&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;26185050&quot;</span> <span class="dt">real</span>, </a>
<a class="sourceLine" id="cb15-36" title="36">     <span class="ot">&quot;26225060&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;26255030&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;27015280&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;27015290&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;27015300&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;27015310&quot;</span> <span class="dt">real</span>, </a>
<a class="sourceLine" id="cb15-37" title="37">     <span class="ot">&quot;27015320&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;27015330&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;28025120&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;28025130&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;28025502&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;28035060&quot;</span> <span class="dt">real</span>, </a>
<a class="sourceLine" id="cb15-38" title="38">     <span class="ot">&quot;29004520&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;29015000&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;29015040&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;29035000&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;29035200&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;29045000&quot;</span> <span class="dt">real</span>, </a>
<a class="sourceLine" id="cb15-39" title="39">     <span class="ot">&quot;29045150&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;29045190&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;29065000&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;29065120&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;29065130&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;31095030&quot;</span> <span class="dt">real</span>, </a>
<a class="sourceLine" id="cb15-40" title="40">     <span class="ot">&quot;32105080&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;35025080&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;35025090&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;35025110&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;35035100&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;35035110&quot;</span> <span class="dt">real</span>, </a>
<a class="sourceLine" id="cb15-41" title="41">     <span class="ot">&quot;35035130&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;35075070&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;35075080&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;35085060&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;35085070&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;35085080&quot;</span> <span class="dt">real</span>, </a>
<a class="sourceLine" id="cb15-42" title="42">     <span class="ot">&quot;35095120&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;35095130&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;35165000&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;35185010&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;35195060&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;35215020&quot;</span> <span class="dt">real</span>, </a>
<a class="sourceLine" id="cb15-43" title="43">     <span class="ot">&quot;35215030&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;35225030&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;35235040&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;35235050&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;36015020&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;37015030&quot;</span> <span class="dt">real</span>, </a>
<a class="sourceLine" id="cb15-44" title="44">     <span class="ot">&quot;44015060&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;44015070&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;44035040&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;44035050&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;46015030&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;46035010&quot;</span> <span class="dt">real</span>, </a>
<a class="sourceLine" id="cb15-45" title="45">     <span class="ot">&quot;47035030&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;48015040&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;48015050&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;51025060&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;51025080&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;52015050&quot;</span> <span class="dt">real</span>, </a>
<a class="sourceLine" id="cb15-46" title="46">     <span class="ot">&quot;52025080&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;52025090&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;52035040&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;52045080&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;52055150&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;52055160&quot;</span> <span class="dt">real</span>, </a>
<a class="sourceLine" id="cb15-47" title="47">     <span class="ot">&quot;52055170&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;52055210&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;52055220&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;52055230&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;53045040&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;53075020&quot;</span> <span class="dt">real</span>, </a>
<a class="sourceLine" id="cb15-48" title="48">     <span class="ot">&quot;54077210&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;55015010&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;56019010&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;57025020&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;1111500036&quot;</span> <span class="dt">real</span>,</a>
<a class="sourceLine" id="cb15-49" title="49">     <span class="ot">&quot;2612500038&quot;</span> <span class="dt">real</span>, <span class="ot">&quot;3706500109&quot;</span> <span class="dt">real</span>)</a></code></pre></div>

<p>Next list shows unstacked tables inside the database:</p>
<ul>
<li>IDEAM_VVMX_60 (correspond to ALL_VVMX_AUT_60)</li>
<li>ISD_LITE_UNSTACK (correspond to ISD_LITE)</li>
</ul>
<p>In addition, stations catalogs of IDEAM and ISD were loaded as tables. Main fields are <em>identifier</em>, <em>name</em>, <em>latitude</em> and <em>longitude</em>:</p>
<ul>
<li>IDEAM_ALL_STATIONS</li>
<li>ISD_ALL_STATIONS</li>
</ul>
<p>Next chunk of code shows the use of <code>dplyr</code> and <code>tibble</code> packages with PostgreSQL tables</p>


<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" title="1">    <span class="kw">library</span>(dplyr)</a>
<a class="sourceLine" id="cb16-2" title="2">    con1 =<span class="st"> </span><span class="kw">src_postgres</span>(<span class="dt">dbname =</span> <span class="st">&quot;winddata&quot;</span>, <span class="dt">host =</span> <span class="st">&quot;localhost&quot;</span>, </a>
<a class="sourceLine" id="cb16-3" title="3">                        <span class="dt">port =</span> <span class="dv">5432</span>, <span class="dt">user =</span> <span class="st">&quot;user1&quot;</span>, <span class="dt">password =</span> <span class="st">&quot;user1&quot;</span>)</a>
<a class="sourceLine" id="cb16-4" title="4">    originalfields3 =<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;id&quot;</span>, <span class="st">&quot;usaf&quot;</span>, <span class="st">&quot;station_name&quot;</span>, <span class="st">&quot;latitud&quot;</span>, <span class="st">&quot;longitud&quot;</span>)</a>
<a class="sourceLine" id="cb16-5" title="5">    originalfields3 =<span class="st"> </span><span class="kw">paste</span>(originalfields3, <span class="dt">collapse=</span> <span class="st">&quot;, &quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb16-6" title="6">    query3 =<span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;select&quot;</span>, originalfields3, </a>
<a class="sourceLine" id="cb16-7" title="7">                   <span class="st">&quot;from isd_all_stations where usaf_isd_dataua != &#39;&#39;&quot;</span>, <span class="dt">sep=</span><span class="st">&quot; &quot;</span>)</a>
<a class="sourceLine" id="cb16-8" title="8">    isd_stations =<span class="st"> </span><span class="kw">as_tibble</span>(<span class="kw">tbl</span>(con1, <span class="kw">sql</span>(query3)))</a>
<a class="sourceLine" id="cb16-9" title="9">    <span class="kw">library</span>(sf)</a>
<a class="sourceLine" id="cb16-10" title="10">    isd_stations =<span class="st"> </span><span class="kw">st_as_sf</span>(isd_stations, <span class="dt">coords =</span> <span class="kw">c</span>(<span class="st">&quot;longitud&quot;</span>, <span class="st">&quot;latitud&quot;</span>), <span class="dt">crs =</span> <span class="dv">4326</span>)</a></code></pre></div>

<p>Object <em>isd_stations</em> belongs to classes <em>sf</em>, <em>tbl_df</em>, <em>tbl</em>, and <em>data.frame</em>. Its description is shown below using the object name.</p>


<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" title="1">        <span class="kw">class</span>(isd_stations)</a></code></pre></div>
<pre><code>[1] &quot;sf&quot;         &quot;tbl_df&quot;     &quot;tbl&quot;        &quot;data.frame&quot;</code></pre>

<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" title="1">        isd_stations</a></code></pre></div>
<pre><code>Simple feature collection with 100 features and 3 fields
geometry type:  POINT
dimension:      XY
bbox:           xmin: -81.711 ymin: -5.894 xmax: 0 ymax: 13.357
epsg (SRID):    4326
proj4string:    +proj=longlat +datum=WGS84 +no_defs
# A tibble: 100 x 4
      id usaf   station_name                  geometry
   &lt;int&gt; &lt;chr&gt;  &lt;chr&gt;                      &lt;POINT [°]&gt;
 1 13848 690186 SAN JOSE DEL GUAVIA    (-72.633 2.567)
 2 14080 698689 MARANDUA AB            (-68.686 5.524)
 3 14081 698704 AFWA ASSIGNED          (-74.633 4.217)
 4 21913 789820 REINA BEATRIX INTL    (-70.015 12.501)
 5 21918 800000 BOGUS COLOMBIAN                  (0 0)
 6 21919 800010 GUSTAVO ROJAS PINILLA (-81.711 12.584)
 7 21921 800020 EL EMBRUJO            (-81.358 13.357)
 8 21925 800090 SIMON BOLIVAR          (-74.231 11.12)
 9 21926 800220 RAFAEL NUNEZ          (-75.513 10.442)
10 21927 800280 ERNESTO CORTISSOZ      (-74.781 10.89)
# ... with 90 more rows</code></pre>

</div>
<div id="database-backup" class="section level2">
<h2><span class="header-section-number">D.2</span> Database Backup</h2>
<p>Next chunks of commands were used to create database backup.</p>
<div id="schema-backup" class="section level3">
<h3><span class="header-section-number">D.2.1</span> Schema Backup</h3>


<div class="sourceCode" id="cb21"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb21-1" title="1">      <span class="ex">pg_dump.exe</span> -f dump-C-E-o-s_winddata_2020_03.sql -C -E UTF8 -o -s -h localhost -U postgres winddata</a></code></pre></div>

</div>
<div id="data-backup" class="section level3">
<h3><span class="header-section-number">D.2.2</span> Data Backup</h3>
<p>Make a backup with option Fc (to load with pg_restore). Be aware of the use of option “copy” (not the option insert –D).</p>


<div class="sourceCode" id="cb22"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb22-1" title="1">      <span class="ex">pg_dump.exe</span> -Fc -a -E UTF8 -h localhost -U postgres -f dump-Fc-a-E_winddata_2020_03.dump winddata</a></code></pre></div>

</div>
<div id="create-table-of-contents-toc-file" class="section level3">
<h3><span class="header-section-number">D.2.3</span> Create Table of Contents (TOC) File</h3>
<p>It is possible to load data from a backup file to the database, using a TOC text file containing the list of tables to be restored. The user can edit this file to decide which tables to restore or change the restoration order. TOC file created with next command, will have the load order by default (this command only works with backups created with the options Fc o Ft)</p>


<div class="sourceCode" id="cb23"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb23-1" title="1">      <span class="ex">pg_restore.exe</span> -l -f dump-Fc-a-E_winddata_2020_03.TOC dump-Fc-a-E_winddata_2020_03.dump</a></code></pre></div>

<p>The content of default TOC file (dump-Fc-a-E_winddata_2020_03.TOC) as result from previous command is shown below</p>


<div class="sourceCode" id="cb24"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb24-1" title="1">      ; <span class="ex">Archive</span> created at 2020-03-25 15:38:55</a>
<a class="sourceLine" id="cb24-2" title="2">      ;     <span class="ex">dbname</span>: winddata</a>
<a class="sourceLine" id="cb24-3" title="3">      ;     <span class="ex">TOC</span> Entries: 17</a>
<a class="sourceLine" id="cb24-4" title="4">      ;     <span class="ex">Compression</span>: -1</a>
<a class="sourceLine" id="cb24-5" title="5">      ;     <span class="ex">Dump</span> Version: 1.13-0</a>
<a class="sourceLine" id="cb24-6" title="6">      ;     <span class="ex">Format</span>: CUSTOM</a>
<a class="sourceLine" id="cb24-7" title="7">      ;     <span class="ex">Integer</span>: 4 bytes</a>
<a class="sourceLine" id="cb24-8" title="8">      ;     <span class="ex">Offset</span>: 8 bytes</a>
<a class="sourceLine" id="cb24-9" title="9">      ;     <span class="ex">Dumped</span> from database version: 10.5</a>
<a class="sourceLine" id="cb24-10" title="10">      ;     <span class="ex">Dumped</span> by pg_dump version: 10.5</a>
<a class="sourceLine" id="cb24-11" title="11">      ; <span class="ex">Selected</span> TOC Entries:</a>
<a class="sourceLine" id="cb24-12" title="12">      <span class="ex">2865</span><span class="kw">;</span> <span class="ex">0</span> 259855 TABLE DATA public ALL_VVMX_AUT_60 user1</a>
<a class="sourceLine" id="cb24-13" title="13">      <span class="ex">2868</span><span class="kw">;</span> <span class="ex">0</span> 259883 TABLE DATA public TEMP user1</a>
<a class="sourceLine" id="cb24-14" title="14">      <span class="ex">2867</span><span class="kw">;</span> <span class="ex">0</span> 259879 TABLE DATA public VV_AUT_10 user1</a>
<a class="sourceLine" id="cb24-15" title="15">      <span class="ex">2875</span><span class="kw">;</span> <span class="ex">0</span> 260005 TABLE DATA public ideam_all_stations user1</a>
<a class="sourceLine" id="cb24-16" title="16">      <span class="ex">2876</span><span class="kw">;</span> <span class="ex">0</span> 260092 TABLE DATA public ideam_vvmx_60 user1</a>
<a class="sourceLine" id="cb24-17" title="17">      <span class="ex">2874</span><span class="kw">;</span> <span class="ex">0</span> 259958 TABLE DATA public isd_all_stations user1</a>
<a class="sourceLine" id="cb24-18" title="18">      <span class="ex">2871</span><span class="kw">;</span> <span class="ex">0</span> 259898 TABLE DATA public isd_lite user1</a>
<a class="sourceLine" id="cb24-19" title="19">      <span class="ex">2873</span><span class="kw">;</span> <span class="ex">0</span> 259926 TABLE DATA public isd_lite_copy user1</a>
<a class="sourceLine" id="cb24-20" title="20">      <span class="ex">2869</span><span class="kw">;</span> <span class="ex">0</span> 259892 TABLE DATA public isd_lite_string user1</a>
<a class="sourceLine" id="cb24-21" title="21">      <span class="ex">2877</span><span class="kw">;</span> <span class="ex">0</span> 260096 TABLE DATA public isd_lite_unstack user1</a>
<a class="sourceLine" id="cb24-22" title="22">      <span class="ex">2883</span><span class="kw">;</span> <span class="ex">0</span> 0 SEQUENCE SET public ALL_VVMX_AUT_60_id_seq user1</a>
<a class="sourceLine" id="cb24-23" title="23">      <span class="ex">2884</span><span class="kw">;</span> <span class="ex">0</span> 0 SEQUENCE SET public ISD_LITE_ID_seq user1</a>
<a class="sourceLine" id="cb24-24" title="24">      <span class="ex">2885</span><span class="kw">;</span> <span class="ex">0</span> 0 SEQUENCE SET public VV_AUT_10_id_seq user1</a>
<a class="sourceLine" id="cb24-25" title="25">      <span class="ex">2886</span><span class="kw">;</span> <span class="ex">0</span> 0 SEQUENCE SET public isd_lite_new_id_seq user1</a></code></pre></div>

</div>
</div>
<div id="database-restore" class="section level2">
<h2><span class="header-section-number">D.3</span> Database Restore</h2>
<div id="schema-load" class="section level3">
<h3><span class="header-section-number">D.3.1</span> Schema Load</h3>
<p>Before to restore the schema from file dump-C-E-o-s_winddata_2020_03.sql, it is possible to manually edit it, considering special user needs:</p>
<ul>
<li>Force to remove the database, if it is already created within PostgreSQL.</li>
<li>Enable extensions for particular needs, for instance PostGis, DBLink, pgRouting, plpgsql</li>
</ul>
<p>In addition, it is important to remember:</p>
<ul>
<li>Database name: winddata</li>
<li>Database user: user1</li>
<li>Log in the database as user <em>postgres</em></li>
<li>In next command, first <em>postgres</em> is the name of database, and second one, is the user name.</li>
</ul>


<div class="sourceCode" id="cb25"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb25-1" title="1">      <span class="ex">psql.exe</span> -f dump-C-E-o-s_winddata_2020_03.sql postgres postgres</a></code></pre></div>

</div>
<div id="load-data" class="section level3">
<h3><span class="header-section-number">D.3.2</span> Load Data</h3>
<p>To load data is necessary to use TOC file, which can be edited to change load order, or load only specific tables. To proceed with next command, please use the user <em>postgres</em></p>


<div class="sourceCode" id="cb26"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb26-1" title="1">      <span class="ex">pg_restore.exe</span> -d winddata -Fc -a -L dump-Fc-a-E_winddata_2020_03.TOC -h localhost -U postgres</a>
<a class="sourceLine" id="cb26-2" title="2">       <span class="ex">-e</span> dump-Fc-a-E_winddata_2020_03.dump</a></code></pre></div>

</div>
<div id="restore-individual-tables" class="section level3">
<h3><span class="header-section-number">D.3.3</span> Restore Individual Tables</h3>
<p>It is possible to restore/load individual tables using next command, where “-n” refers to schema and “-t” refers to table name. Next command will restore table <em>ideam_vvmx_60</em> from <em>public</em> schema (all tables belong to public schema)</p>


<div class="sourceCode" id="cb27"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb27-1" title="1">      <span class="ex">pg_restore</span> -d winddata -Fc -a -h localhost -U postgres -n public -t ideam_vvmx_60 -v </a>
<a class="sourceLine" id="cb27-2" title="2">       <span class="ex">-e</span> dump-Fc-a-E_winddata_2020_03.dump</a></code></pre></div>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="C-datadownload.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="E-docrcode.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": [["thesis.pdf", "PDF"], ["thesis.epub", "EPUB"], ["thesis.docx", "Word"]],
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
