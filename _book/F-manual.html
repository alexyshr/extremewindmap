<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>F User Manual | Spatio-temporal analysis of extreme wind velocities for infrastructure design</title>
  <meta name="description" content="F User Manual | Spatio-temporal analysis of extreme wind velocities for infrastructure design" />
  <meta name="generator" content="bookdown 0.19 and GitBook 2.6.7" />

  <meta property="og:title" content="F User Manual | Spatio-temporal analysis of extreme wind velocities for infrastructure design" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="F User Manual | Spatio-temporal analysis of extreme wind velocities for infrastructure design" />
  
  
  

<meta name="author" content="Alexys Herleym Rodríguez Avellaneda" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="E-docrcode.html"/>

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/kePrint-0.0.1/kePrint.js"></script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./"></a></li>
<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preliminary Content</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgments"><i class="fa fa-check"></i>Acknowledgments</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#abstract"><i class="fa fa-check"></i>Abstract</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="1-introduction.html"><a href="1-introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="1-introduction.html"><a href="1-introduction.html#context-and-background"><i class="fa fa-check"></i><b>1.1</b> Context and Background</a></li>
<li class="chapter" data-level="1.2" data-path="1-introduction.html"><a href="1-introduction.html#problem-statement-and-motivation"><i class="fa fa-check"></i><b>1.2</b> Problem Statement and Motivation</a></li>
<li class="chapter" data-level="1.3" data-path="1-introduction.html"><a href="1-introduction.html#knowledge-gap"><i class="fa fa-check"></i><b>1.3</b> Knowledge Gap</a></li>
<li class="chapter" data-level="1.4" data-path="1-introduction.html"><a href="1-introduction.html#research-aim-and-objectives"><i class="fa fa-check"></i><b>1.4</b> Research Aim and Objectives</a></li>
<li class="chapter" data-level="1.5" data-path="1-introduction.html"><a href="1-introduction.html#research-question"><i class="fa fa-check"></i><b>1.5</b> Research Question</a></li>
<li class="chapter" data-level="1.6" data-path="1-introduction.html"><a href="1-introduction.html#case-study"><i class="fa fa-check"></i><b>1.6</b> Case Study</a></li>
<li class="chapter" data-level="1.7" data-path="1-introduction.html"><a href="1-introduction.html#outline"><i class="fa fa-check"></i><b>1.7</b> Outline</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="2-rmd-data.html"><a href="2-rmd-data.html"><i class="fa fa-check"></i><b>2</b> Data</a><ul>
<li class="chapter" data-level="2.1" data-path="2-rmd-data.html"><a href="2-rmd-data.html#ideam"><i class="fa fa-check"></i><b>2.1</b> IDEAM</a></li>
<li class="chapter" data-level="2.2" data-path="2-rmd-data.html"><a href="2-rmd-data.html#isd"><i class="fa fa-check"></i><b>2.2</b> ISD</a></li>
<li class="chapter" data-level="2.3" data-path="2-rmd-data.html"><a href="2-rmd-data.html#era5"><i class="fa fa-check"></i><b>2.3</b> ERA5</a></li>
<li class="chapter" data-level="2.4" data-path="2-rmd-data.html"><a href="2-rmd-data.html#data-download-and-data-organization"><i class="fa fa-check"></i><b>2.4</b> Data Download and Data Organization</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="3-rmd-thefra.html"><a href="3-rmd-thefra.html"><i class="fa fa-check"></i><b>3</b> Theoretical Framework</a><ul>
<li class="chapter" data-level="3.1" data-path="3-rmd-thefra.html"><a href="3-rmd-thefra.html#probability-concepts"><i class="fa fa-check"></i><b>3.1</b> Probability Concepts</a><ul>
<li class="chapter" data-level="3.1.1" data-path="3-rmd-thefra.html"><a href="3-rmd-thefra.html#probability-density-function-pdf"><i class="fa fa-check"></i><b>3.1.1</b> Probability Density Function PDF</a></li>
<li class="chapter" data-level="3.1.2" data-path="3-rmd-thefra.html"><a href="3-rmd-thefra.html#cumulative-distribution-function-cdf"><i class="fa fa-check"></i><b>3.1.2</b> Cumulative Distribution Function CDF</a></li>
<li class="chapter" data-level="3.1.3" data-path="3-rmd-thefra.html"><a href="3-rmd-thefra.html#percent-point-function-ppf"><i class="fa fa-check"></i><b>3.1.3</b> Percent Point Function PPF</a></li>
<li class="chapter" data-level="3.1.4" data-path="3-rmd-thefra.html"><a href="3-rmd-thefra.html#hf"><i class="fa fa-check"></i><b>3.1.4</b> Hazard Function HF</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="3-rmd-thefra.html"><a href="3-rmd-thefra.html#statistical-concepts-for-extreme-analysis"><i class="fa fa-check"></i><b>3.2</b> Statistical Concepts for Extreme Analysis</a><ul>
<li class="chapter" data-level="3.2.1" data-path="3-rmd-thefra.html"><a href="3-rmd-thefra.html#annual-exceedance-probability-p_e"><i class="fa fa-check"></i><b>3.2.1</b> Annual Exceedance Probability <span class="math inline">\(P_e\)</span></a></li>
<li class="chapter" data-level="3.2.2" data-path="3-rmd-thefra.html"><a href="3-rmd-thefra.html#mean-recurrence-interval-mri"><i class="fa fa-check"></i><b>3.2.2</b> Mean Recurrence Interval MRI</a></li>
<li class="chapter" data-level="3.2.3" data-path="3-rmd-thefra.html"><a href="3-rmd-thefra.html#compound-exceedance-probability-pn"><i class="fa fa-check"></i><b>3.2.3</b> Compound Exceedance Probability Pn</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="3-rmd-thefra.html"><a href="3-rmd-thefra.html#extremeoverview"><i class="fa fa-check"></i><b>3.3</b> Extreme Value Analysis Overview</a><ul>
<li class="chapter" data-level="3.3.1" data-path="3-rmd-thefra.html"><a href="3-rmd-thefra.html#epochal-sample-maxima"><i class="fa fa-check"></i><b>3.3.1</b> Epochal (Sample Maxima)</a></li>
<li class="chapter" data-level="3.3.2" data-path="3-rmd-thefra.html"><a href="3-rmd-thefra.html#pot-poisson-gpd"><i class="fa fa-check"></i><b>3.3.2</b> Peaks Over Threshold using GPD and 1D Poisson Process POT-Poisson-GPD</a></li>
<li class="chapter" data-level="3.3.3" data-path="3-rmd-thefra.html"><a href="3-rmd-thefra.html#method-pot-pp"><i class="fa fa-check"></i><b>3.3.3</b> Peaks Over Threshold Using a 2D Poisson Process POT-PP</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="3-rmd-thefra.html"><a href="3-rmd-thefra.html#windloadsrequirements"><i class="fa fa-check"></i><b>3.4</b> Wind Loads Requirements</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="4-rmd-method.html"><a href="4-rmd-method.html"><i class="fa fa-check"></i><b>4</b> Methodology</a><ul>
<li class="chapter" data-level="4.1" data-path="4-rmd-method.html"><a href="4-rmd-method.html#rmd-standardization"><i class="fa fa-check"></i><b>4.1</b> Data Standardization</a><ul>
<li class="chapter" data-level="4.1.1" data-path="4-rmd-method.html"><a href="4-rmd-method.html#anemometer-height-10-m"><i class="fa fa-check"></i><b>4.1.1</b> Anemometer Height (10 m)</a></li>
<li class="chapter" data-level="4.1.2" data-path="4-rmd-method.html"><a href="4-rmd-method.html#rmd-roughness"><i class="fa fa-check"></i><b>4.1.2</b> Surface Roughness at Open Terrain</a></li>
<li class="chapter" data-level="4.1.3" data-path="4-rmd-method.html"><a href="4-rmd-method.html#rmd-gust"><i class="fa fa-check"></i><b>4.1.3</b> Averaging Time: 3-s Gust</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="4-rmd-method.html"><a href="4-rmd-method.html#ds"><i class="fa fa-check"></i><b>4.2</b> Downscaling Support</a></li>
<li class="chapter" data-level="4.3" data-path="4-rmd-method.html"><a href="4-rmd-method.html#pot-pp"><i class="fa fa-check"></i><b>4.3</b> Temporal Analysis (POT-PP)</a><ul>
<li class="chapter" data-level="4.3.1" data-path="4-rmd-method.html"><a href="4-rmd-method.html#decluster"><i class="fa fa-check"></i><b>4.3.1</b> De-clustering</a></li>
<li class="chapter" data-level="4.3.2" data-path="4-rmd-method.html"><a href="4-rmd-method.html#thresholding"><i class="fa fa-check"></i><b>4.3.2</b> Thresholding</a></li>
<li class="chapter" data-level="4.3.3" data-path="4-rmd-method.html"><a href="4-rmd-method.html#exclude-no-data-periods"><i class="fa fa-check"></i><b>4.3.3</b> Exclude No-Data Periods</a></li>
<li class="chapter" data-level="4.3.4" data-path="4-rmd-method.html"><a href="4-rmd-method.html#fit-intensity-function"><i class="fa fa-check"></i><b>4.3.4</b> Fit Intensity Function</a></li>
<li class="chapter" data-level="4.3.5" data-path="4-rmd-method.html"><a href="4-rmd-method.html#hazard-curve-and-return-levels-rl"><i class="fa fa-check"></i><b>4.3.5</b> Hazard Curve and Return Levels RL</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="4-rmd-method.html"><a href="4-rmd-method.html#si"><i class="fa fa-check"></i><b>4.4</b> Spatial Interpolation</a></li>
<li class="chapter" data-level="4.5" data-path="4-rmd-method.html"><a href="4-rmd-method.html#integration"><i class="fa fa-check"></i><b>4.5</b> Integration with Hurricane Data</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="5-rmd-results.html"><a href="5-rmd-results.html"><i class="fa fa-check"></i><b>5</b> Results and Discussion</a><ul>
<li class="chapter" data-level="5.1" data-path="5-rmd-results.html"><a href="5-rmd-results.html#data-standardization-and-downscaling-support"><i class="fa fa-check"></i><b>5.1</b> Data Standardization and Downscaling Support</a><ul>
<li class="chapter" data-level="5.1.1" data-path="5-rmd-results.html"><a href="5-rmd-results.html#data-standardization"><i class="fa fa-check"></i><b>5.1.1</b> Data Standardization</a></li>
<li class="chapter" data-level="5.1.2" data-path="5-rmd-results.html"><a href="5-rmd-results.html#data-comparison"><i class="fa fa-check"></i><b>5.1.2</b> Data Comparison</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="5-rmd-results.html"><a href="5-rmd-results.html#pot-pp-for-isd-station-801120"><i class="fa fa-check"></i><b>5.2</b> POT-PP for ISD Station 801120</a><ul>
<li class="chapter" data-level="5.2.1" data-path="5-rmd-results.html"><a href="5-rmd-results.html#raw-data-de-clustering-and-thresholding"><i class="fa fa-check"></i><b>5.2.1</b> Raw Data, De-clustering, and Thresholding</a></li>
<li class="chapter" data-level="5.2.2" data-path="5-rmd-results.html"><a href="5-rmd-results.html#fitted-pdf-and-cdf-and-goodness-of-fit"><i class="fa fa-check"></i><b>5.2.2</b> Fitted PDF and CDF, and Goodness of Fit</a></li>
<li class="chapter" data-level="5.2.3" data-path="5-rmd-results.html"><a href="5-rmd-results.html#hazard-curve-and-return-levels-rl-1"><i class="fa fa-check"></i><b>5.2.3</b> Hazard Curve and Return Levels RL</a></li>
<li class="chapter" data-level="5.2.4" data-path="5-rmd-results.html"><a href="5-rmd-results.html#comparison-with-pot-poisson-gpd-and-common-extreme-value-distributions"><i class="fa fa-check"></i><b>5.2.4</b> Comparison with POT-Poisson-GPD and Common Extreme Value Distributions</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="5-rmd-results.html"><a href="5-rmd-results.html#wind-maps"><i class="fa fa-check"></i><b>5.3</b> Wind Maps</a><ul>
<li class="chapter" data-level="5.3.1" data-path="5-rmd-results.html"><a href="5-rmd-results.html#existing-hurricane-maps"><i class="fa fa-check"></i><b>5.3.1</b> Existing Hurricane Maps</a></li>
<li class="chapter" data-level="5.3.2" data-path="5-rmd-results.html"><a href="5-rmd-results.html#non-hurricane-maps"><i class="fa fa-check"></i><b>5.3.2</b> Non-Hurricane Maps</a></li>
<li class="chapter" data-level="5.3.3" data-path="5-rmd-results.html"><a href="5-rmd-results.html#cm"><i class="fa fa-check"></i><b>5.3.3</b> Combined Maps</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="5-rmd-results.html"><a href="5-rmd-results.html#fd"><i class="fa fa-check"></i><b>5.4</b> Final Discussion and Future Work</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="6-conclusions.html"><a href="6-conclusions.html"><i class="fa fa-check"></i><b>6</b> Conclusions</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="A-rcode.html"><a href="A-rcode.html"><i class="fa fa-check"></i><b>A</b> Research R Code - Digital Files</a></li>
<li class="chapter" data-level="B" data-path="B-results.html"><a href="B-results.html"><i class="fa fa-check"></i><b>B</b> Results - Digital Files</a></li>
<li class="chapter" data-level="C" data-path="C-datadownload.html"><a href="C-datadownload.html"><i class="fa fa-check"></i><b>C</b> ERA5 Data Download</a></li>
<li class="chapter" data-level="D" data-path="D-dbstoring.html"><a href="D-dbstoring.html"><i class="fa fa-check"></i><b>D</b> Database Storing</a><ul>
<li class="chapter" data-level="D.1" data-path="D-dbstoring.html"><a href="D-dbstoring.html#loading-time-series-from-text-files-to-postgresql"><i class="fa fa-check"></i><b>D.1</b> Loading Time Series from Text Files to PostgreSQL</a></li>
<li class="chapter" data-level="D.2" data-path="D-dbstoring.html"><a href="D-dbstoring.html#database-backup"><i class="fa fa-check"></i><b>D.2</b> Database Backup</a><ul>
<li class="chapter" data-level="D.2.1" data-path="D-dbstoring.html"><a href="D-dbstoring.html#schema-backup"><i class="fa fa-check"></i><b>D.2.1</b> Schema Backup</a></li>
<li class="chapter" data-level="D.2.2" data-path="D-dbstoring.html"><a href="D-dbstoring.html#data-backup"><i class="fa fa-check"></i><b>D.2.2</b> Data Backup</a></li>
<li class="chapter" data-level="D.2.3" data-path="D-dbstoring.html"><a href="D-dbstoring.html#create-table-of-contents-toc-file"><i class="fa fa-check"></i><b>D.2.3</b> Create Table of Contents (TOC) File</a></li>
</ul></li>
<li class="chapter" data-level="D.3" data-path="D-dbstoring.html"><a href="D-dbstoring.html#database-restore"><i class="fa fa-check"></i><b>D.3</b> Database Restore</a><ul>
<li class="chapter" data-level="D.3.1" data-path="D-dbstoring.html"><a href="D-dbstoring.html#schema-load"><i class="fa fa-check"></i><b>D.3.1</b> Schema Load</a></li>
<li class="chapter" data-level="D.3.2" data-path="D-dbstoring.html"><a href="D-dbstoring.html#load-data"><i class="fa fa-check"></i><b>D.3.2</b> Load Data</a></li>
<li class="chapter" data-level="D.3.3" data-path="D-dbstoring.html"><a href="D-dbstoring.html#restore-individual-tables"><i class="fa fa-check"></i><b>D.3.3</b> Restore Individual Tables</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="E" data-path="E-docrcode.html"><a href="E-docrcode.html"><i class="fa fa-check"></i><b>E</b> Thesis Document R Code</a></li>
<li class="chapter" data-level="F" data-path="F-manual.html"><a href="F-manual.html"><i class="fa fa-check"></i><b>F</b> User Manual</a><ul>
<li class="chapter" data-level="F.1" data-path="F-manual.html"><a href="F-manual.html#data-standardization-1"><i class="fa fa-check"></i><b>F.1</b> Data Standardization</a></li>
<li class="chapter" data-level="F.2" data-path="F-manual.html"><a href="F-manual.html#downscaling-support"><i class="fa fa-check"></i><b>F.2</b> Downscaling Support</a><ul>
<li class="chapter" data-level="F.2.1" data-path="F-manual.html"><a href="F-manual.html#quality-data-comparison"><i class="fa fa-check"></i><b>F.2.1</b> Quality Data Comparison</a></li>
<li class="chapter" data-level="F.2.2" data-path="F-manual.html"><a href="F-manual.html#non-quality-data-comparison"><i class="fa fa-check"></i><b>F.2.2</b> Non-quality Data Comparison</a></li>
</ul></li>
<li class="chapter" data-level="F.3" data-path="F-manual.html"><a href="F-manual.html#pot-pp-1"><i class="fa fa-check"></i><b>F.3</b> POT-PP</a><ul>
<li class="chapter" data-level="F.3.1" data-path="F-manual.html"><a href="F-manual.html#isd-1"><i class="fa fa-check"></i><b>F.3.1</b> ISD</a></li>
<li class="chapter" data-level="F.3.2" data-path="F-manual.html"><a href="F-manual.html#era5-1"><i class="fa fa-check"></i><b>F.3.2</b> ERA5</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Spatio-temporal analysis of extreme wind velocities for infrastructure design</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="manual" class="section level1">
<h1><span class="header-section-number">F</span> User Manual</h1>
<p>Software requirements:</p>
<ul>
<li>Software R version 3.6.2 (2019-12-12). Platform x86_64-w64-mingw32. Arch x86_64. Os mingw32. System x86_64, mingw32. Svn rev 77560. Language R. Nickname Dark and Stormy Night.</li>
<li>RStudio - Version 1.2.5033 - 2009-2019. “Orange Blossom” (330255dd, 2019-12-04)</li>
<li>Sixty (60) <strong>R</strong> packages. Use next chunk of code to install and load R packages.</li>
</ul>


<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb46-1" title="1"><span class="co"># List of packages required for this analysis</span></a>
<a class="sourceLine" id="cb46-2" title="2">  pkg &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;actuar&quot;</span>, <span class="st">&quot;bbmle&quot;</span>, <span class="st">&quot;bookdown&quot;</span>, <span class="st">&quot;cowplot&quot;</span>, <span class="st">&quot;devtools&quot;</span>, <span class="st">&quot;DiagrammeR&quot;</span>, <span class="st">&quot;dplyr&quot;</span>, <span class="st">&quot;evd&quot;</span>, <span class="st">&quot;evir&quot;</span>, <span class="st">&quot;evmix&quot;</span>, <span class="st">&quot;extRemes&quot;</span>, <span class="st">&quot;extremeStat&quot;</span>, </a>
<a class="sourceLine" id="cb46-3" title="3">  <span class="st">&quot;fitdistrplus&quot;</span>, <span class="st">&quot;geoR&quot;</span>, <span class="st">&quot;ggmap&quot;</span>, <span class="st">&quot;ggplot2&quot;</span>, <span class="st">&quot;ggrepel&quot;</span>, <span class="st">&quot;ggspatial&quot;</span>, <span class="st">&quot;grid&quot;</span>, <span class="st">&quot;gridExtra&quot;</span>, <span class="st">&quot;gstat&quot;</span>, <span class="st">&quot;ismev&quot;</span>, <span class="st">&quot;kableExtra&quot;</span>, <span class="st">&quot;knitr&quot;</span>, <span class="st">&quot;lattice&quot;</span>, </a>
<a class="sourceLine" id="cb46-4" title="4">  <span class="st">&quot;lmom&quot;</span>, <span class="st">&quot;lmomco&quot;</span>, <span class="st">&quot;lubridate&quot;</span>, <span class="st">&quot;magick&quot;</span>, <span class="st">&quot;maptools&quot;</span>, <span class="st">&quot;mapview&quot;</span>, <span class="st">&quot;MASS&quot;</span>, <span class="st">&quot;ncdf4&quot;</span>, <span class="st">&quot;openair&quot;</span>, <span class="st">&quot;plot3D&quot;</span>, <span class="st">&quot;plotly&quot;</span>, <span class="st">&quot;POT&quot;</span>, <span class="st">&quot;quantmod&quot;</span>, <span class="st">&quot;raster&quot;</span>, </a>
<a class="sourceLine" id="cb46-5" title="5">  <span class="st">&quot;RcmdrMisc&quot;</span>, <span class="st">&quot;RColorBrewer&quot;</span>, <span class="st">&quot;Renext&quot;</span>, <span class="st">&quot;rgdal&quot;</span>, <span class="st">&quot;rgl&quot;</span>, <span class="st">&quot;rnaturaleearth&quot;</span>, <span class="st">&quot;rnaturaleearthdata&quot;</span>, <span class="st">&quot;RPostgreSQL&quot;</span>, <span class="st">&quot;RStoolbox&quot;</span>, <span class="st">&quot;sf&quot;</span>, <span class="st">&quot;shape&quot;</span>, </a>
<a class="sourceLine" id="cb46-6" title="6">  <span class="st">&quot;sp&quot;</span>, <span class="st">&quot;SpatialExtremes&quot;</span>, <span class="st">&quot;stars&quot;</span>, <span class="st">&quot;thesisdown&quot;</span>, <span class="st">&quot;tibble&quot;</span>, <span class="st">&quot;tidyr&quot;</span>, <span class="st">&quot;viridis&quot;</span>, <span class="st">&quot;xls&quot;</span>, <span class="st">&quot;xlsx&quot;</span>, <span class="st">&quot;xts&quot;</span>)</a>
<a class="sourceLine" id="cb46-7" title="7"><span class="co"># Check if packages are not installed and assign the</span></a>
<a class="sourceLine" id="cb46-8" title="8"><span class="co"># names of the packages not installed to the variable new.pkg</span></a>
<a class="sourceLine" id="cb46-9" title="9">  new.pkg &lt;-<span class="st"> </span>pkg[<span class="op">!</span>(pkg <span class="op">%in%</span><span class="st"> </span><span class="kw">installed.packages</span>())]</a>
<a class="sourceLine" id="cb46-10" title="10"><span class="co"># If there are any packages in the list that aren&#39;t installed,</span></a>
<a class="sourceLine" id="cb46-11" title="11"><span class="co"># install them</span></a>
<a class="sourceLine" id="cb46-12" title="12">  <span class="cf">if</span> (<span class="kw">length</span>(new.pkg))</a>
<a class="sourceLine" id="cb46-13" title="13">    <span class="kw">install.packages</span>(new.pkg, <span class="dt">repos =</span> <span class="st">&quot;http://cran.rstudio.com&quot;</span>)</a>
<a class="sourceLine" id="cb46-14" title="14"><span class="co">#Load packages</span></a>
<a class="sourceLine" id="cb46-15" title="15">  <span class="kw">library</span>(actuar)</a>
<a class="sourceLine" id="cb46-16" title="16">  <span class="kw">library</span>(bbmle)</a>
<a class="sourceLine" id="cb46-17" title="17">  <span class="kw">library</span>(bookdown)</a>
<a class="sourceLine" id="cb46-18" title="18">  <span class="kw">library</span>(cowplot)</a>
<a class="sourceLine" id="cb46-19" title="19">  <span class="kw">library</span>(devtools)</a>
<a class="sourceLine" id="cb46-20" title="20">  <span class="kw">library</span>(DiagrammeR)</a>
<a class="sourceLine" id="cb46-21" title="21">  <span class="kw">library</span>(dplyr)</a>
<a class="sourceLine" id="cb46-22" title="22">  <span class="kw">library</span>(evd)</a>
<a class="sourceLine" id="cb46-23" title="23">  <span class="kw">library</span>(evir)</a>
<a class="sourceLine" id="cb46-24" title="24">  <span class="kw">library</span>(evmix)</a>
<a class="sourceLine" id="cb46-25" title="25">  <span class="kw">library</span>(extRemes)</a>
<a class="sourceLine" id="cb46-26" title="26">  <span class="kw">library</span>(extremeStat)</a>
<a class="sourceLine" id="cb46-27" title="27">  <span class="kw">library</span>(fitdistrplus)</a>
<a class="sourceLine" id="cb46-28" title="28">  <span class="kw">library</span>(geoR)</a>
<a class="sourceLine" id="cb46-29" title="29">  <span class="kw">library</span>(ggmap)</a>
<a class="sourceLine" id="cb46-30" title="30">  <span class="kw">library</span>(ggplot2)</a>
<a class="sourceLine" id="cb46-31" title="31">  <span class="kw">library</span>(ggrepel)</a>
<a class="sourceLine" id="cb46-32" title="32">  <span class="kw">library</span>(ggspatial)</a>
<a class="sourceLine" id="cb46-33" title="33">  <span class="kw">library</span>(grid)</a>
<a class="sourceLine" id="cb46-34" title="34">  <span class="kw">library</span>(gridExtra)</a>
<a class="sourceLine" id="cb46-35" title="35">  <span class="kw">library</span>(gstat)</a>
<a class="sourceLine" id="cb46-36" title="36">  <span class="kw">library</span>(ismev)</a>
<a class="sourceLine" id="cb46-37" title="37">  <span class="kw">library</span>(kableExtra)</a>
<a class="sourceLine" id="cb46-38" title="38">  <span class="kw">library</span>(knitr)</a>
<a class="sourceLine" id="cb46-39" title="39">  <span class="kw">library</span>(lattice)</a>
<a class="sourceLine" id="cb46-40" title="40">  <span class="kw">library</span>(lmom)</a>
<a class="sourceLine" id="cb46-41" title="41">  <span class="kw">library</span>(lmomco)</a>
<a class="sourceLine" id="cb46-42" title="42">  <span class="kw">library</span>(lubridate)</a>
<a class="sourceLine" id="cb46-43" title="43">  <span class="kw">library</span>(magick)</a>
<a class="sourceLine" id="cb46-44" title="44">  <span class="kw">library</span>(maptools)</a>
<a class="sourceLine" id="cb46-45" title="45">  <span class="kw">library</span>(mapview)</a>
<a class="sourceLine" id="cb46-46" title="46">  <span class="kw">library</span>(MASS)</a>
<a class="sourceLine" id="cb46-47" title="47">  <span class="kw">library</span>(ncdf4)</a>
<a class="sourceLine" id="cb46-48" title="48">  <span class="kw">library</span>(openair)</a>
<a class="sourceLine" id="cb46-49" title="49">  <span class="kw">library</span>(plot3D)</a>
<a class="sourceLine" id="cb46-50" title="50">  <span class="kw">library</span>(plotly)</a>
<a class="sourceLine" id="cb46-51" title="51">  <span class="kw">library</span>(POT)</a>
<a class="sourceLine" id="cb46-52" title="52">  <span class="kw">library</span>(quantmod)</a>
<a class="sourceLine" id="cb46-53" title="53">  <span class="kw">library</span>(raster)</a>
<a class="sourceLine" id="cb46-54" title="54">  <span class="kw">library</span>(RcmdrMisc)</a>
<a class="sourceLine" id="cb46-55" title="55">  <span class="kw">library</span>(RColorBrewer)</a>
<a class="sourceLine" id="cb46-56" title="56">  <span class="kw">library</span>(Renext)</a>
<a class="sourceLine" id="cb46-57" title="57">  <span class="kw">library</span>(rgdal)</a>
<a class="sourceLine" id="cb46-58" title="58">  <span class="kw">library</span>(rgl)</a>
<a class="sourceLine" id="cb46-59" title="59">  <span class="kw">library</span>(rnaturaleearth)</a>
<a class="sourceLine" id="cb46-60" title="60">  <span class="kw">library</span>(rnaturaleearthdata)</a>
<a class="sourceLine" id="cb46-61" title="61">  <span class="kw">library</span>(RPostgreSQL)</a>
<a class="sourceLine" id="cb46-62" title="62">  <span class="kw">library</span>(RStoolbox)</a>
<a class="sourceLine" id="cb46-63" title="63">  <span class="kw">library</span>(sf)</a>
<a class="sourceLine" id="cb46-64" title="64">  <span class="kw">library</span>(shape)</a>
<a class="sourceLine" id="cb46-65" title="65">  <span class="kw">library</span>(sp)</a>
<a class="sourceLine" id="cb46-66" title="66">  <span class="kw">library</span>(SpatialExtremes)</a>
<a class="sourceLine" id="cb46-67" title="67">  <span class="kw">library</span>(stars)</a>
<a class="sourceLine" id="cb46-68" title="68">  <span class="kw">library</span>(thesisdown)</a>
<a class="sourceLine" id="cb46-69" title="69">  <span class="kw">library</span>(tibble)</a>
<a class="sourceLine" id="cb46-70" title="70">  <span class="kw">library</span>(tidyr)</a>
<a class="sourceLine" id="cb46-71" title="71">  <span class="kw">library</span>(viridis)</a>
<a class="sourceLine" id="cb46-72" title="72">  <span class="kw">library</span>(xls)</a>
<a class="sourceLine" id="cb46-73" title="73">  <span class="kw">library</span>(xlsx)</a>
<a class="sourceLine" id="cb46-74" title="74">  <span class="kw">library</span>(xts</a></code></pre></div>

<div id="data-standardization-1" class="section level2">
<h2><span class="header-section-number">F.1</span> Data Standardization</h2>
<p>After calculation of correction factors for each station (IDEAM or ISD), see <em><a href="4-rmd-method.html#rmd-standardization">Data Standardization</a></em> in <em><a href="4-rmd-method.html#rmd-method">Methodology</a></em> section, procedure to modify original wind velocity values using R code, can be done by different ways.</p>
<p>There is one text file for each station time series in IDEAM variables VV_AUT_2 (instantaneous wind velocity each two seconds), and VV_AUT_10 (instantaneous wind velocity each ten seconds), see <a href="2-rmd-data.html#tab:tabledatasources2">2.2</a>. There are twelve files corresponding to twelve different stations. File names follow the format <em>VV_AUT_2@*.data</em>, where * is replaced by the station identifier, as can be seen below. Same format applies to files in variable VV_AUT_10.</p>


<div class="sourceCode" id="cb47"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb47-1" title="1">      <span class="ex">VV_AUT_2@48015050.data</span></a>
<a class="sourceLine" id="cb47-2" title="2">      <span class="ex">VV_AUT_2@52055230.data</span></a>
<a class="sourceLine" id="cb47-3" title="3">      <span class="ex">VV_AUT_2@26125061.data</span></a>
<a class="sourceLine" id="cb47-4" title="4">      <span class="ex">...</span></a></code></pre></div>

<p>Below is the content of a time series file (VV_AUT_2@48015050.data). It has two columns (Fecha and Valor) separated by character |.</p>


<div class="sourceCode" id="cb48"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb48-1" title="1">      <span class="ex">Fecha</span><span class="kw">|</span><span class="ex">Valor</span></a>
<a class="sourceLine" id="cb48-2" title="2">      <span class="ex">2019-01-04</span> 00:00:00<span class="kw">|</span><span class="ex">0.2</span></a>
<a class="sourceLine" id="cb48-3" title="3">      <span class="ex">2019-01-04</span> 00:02:00<span class="kw">|</span><span class="ex">0.4</span></a>
<a class="sourceLine" id="cb48-4" title="4">      <span class="ex">2019-01-04</span> 00:04:00<span class="kw">|</span><span class="ex">0.4</span></a>
<a class="sourceLine" id="cb48-5" title="5">      <span class="ex">...</span></a></code></pre></div>

<p>Next code from IDEAM variable VV_AUT_2 (wind velocity each two seconds), read all twelve time series text files from folder <em>./data/manual/VV_AUT_2/</em>, calculate hourly mean, apply a 3-s gust correction factor of 1.52, and roughness corrections factors stored in the column <em>fc_zo</em> of <em>stationssample</em> data-frame, nonetheless, this code is not efficient in terms of memory management because it loads all times series to memory using the object <em>ldf</em>, and load all standardized time series to memory using object <em>ldf_hourlymean</em>.</p>


<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb49-1" title="1">    path_vv_aut_<span class="dv">2</span> =<span class="st"> &quot;./data/manual/VV_AUT_2/&quot;</span></a>
<a class="sourceLine" id="cb49-2" title="2">    filenames =<span class="st"> </span><span class="kw">list.files</span>(path_vv_aut_<span class="dv">2</span>, <span class="dt">pattern =</span> <span class="st">&quot;VV_AUT_2@&quot;</span>)</a>
<a class="sourceLine" id="cb49-3" title="3">    <span class="co">#Be aware that ldf is a list of dataframes and you need to do [[]], to go inside it</span></a>
<a class="sourceLine" id="cb49-4" title="4">    <span class="co">#Create a list dataframes in ldf</span></a>
<a class="sourceLine" id="cb49-5" title="5">    <span class="co">#To access each station time series, you need to use ldf[[integer]]</span></a>
<a class="sourceLine" id="cb49-6" title="6">    ldf =<span class="st"> </span><span class="kw">lapply</span>(filenames, <span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb49-7" title="7">      dat =<span class="st"> </span><span class="kw">read.table</span>(<span class="kw">paste0</span>(path_vv_aut_<span class="dv">2</span>, x), <span class="dt">header=</span><span class="ot">TRUE</span>, <span class="dt">sep=</span><span class="st">&quot;|&quot;</span>, <span class="dt">stringsAsFactors=</span><span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb49-8" title="8">      <span class="co"># Add column names</span></a>
<a class="sourceLine" id="cb49-9" title="9">        <span class="kw">names</span>(dat) =<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;fecha&#39;</span>, <span class="st">&#39;valor&#39;</span>)</a>
<a class="sourceLine" id="cb49-10" title="10">      <span class="co">#Take control of possible bad original values</span></a>
<a class="sourceLine" id="cb49-11" title="11">        dat<span class="op">$</span>valor[dat<span class="op">$</span>valor <span class="op">&gt;</span><span class="st"> </span><span class="dv">300</span>] =<span class="st"> </span><span class="ot">NA</span></a>
<a class="sourceLine" id="cb49-12" title="12">        dat<span class="op">$</span>valor[dat<span class="op">$</span>valor <span class="op">&lt;</span><span class="st"> </span><span class="dv">1</span>] =<span class="st"> </span><span class="ot">NA</span></a>
<a class="sourceLine" id="cb49-13" title="13">      <span class="co">#Get station id from file name</span></a>
<a class="sourceLine" id="cb49-14" title="14">        dat<span class="op">$</span>station_id =<span class="st"> </span><span class="kw">substring</span>(x,<span class="dv">10</span>,<span class="kw">nchar</span>(x)<span class="op">-</span><span class="dv">5</span>) </a>
<a class="sourceLine" id="cb49-15" title="15">      <span class="co">#Add datetime object</span></a>
<a class="sourceLine" id="cb49-16" title="16">        dat<span class="op">$</span>mydatetime =<span class="st"> </span><span class="kw">as.POSIXct</span>(dat<span class="op">$</span>fecha,<span class="dt">format=</span><span class="st">&quot;%Y-%m-%d %H:%M:%S&quot;</span>, <span class="dt">tz=</span><span class="st">&quot;UTC&quot;</span>)</a>
<a class="sourceLine" id="cb49-17" title="17">        <span class="kw">return</span>(dat)})  </a>
<a class="sourceLine" id="cb49-18" title="18">    <span class="co">#Stations IDs and Roughness corrections factors</span></a>
<a class="sourceLine" id="cb49-19" title="19">      stationssample =<span class="st"> </span><span class="kw">data.frame</span>(</a>
<a class="sourceLine" id="cb49-20" title="20">        <span class="dt">ideam_id =</span> <span class="kw">as.character</span>(</a>
<a class="sourceLine" id="cb49-21" title="21">          <span class="kw">c</span>(<span class="dv">48015050</span>, <span class="dv">52055230</span>, <span class="dv">26125061</span>, <span class="dv">26125710</span>, <span class="dv">23085270</span>, <span class="dv">27015330</span>, </a>
<a class="sourceLine" id="cb49-22" title="22">            <span class="dv">16015501</span>, <span class="dv">23195502</span>, <span class="dv">13035501</span>, <span class="dv">28025502</span>, <span class="dv">15065180</span>, <span class="dv">29045190</span>)),</a>
<a class="sourceLine" id="cb49-23" title="23">        <span class="dt">fc_zo =</span> </a>
<a class="sourceLine" id="cb49-24" title="24">          <span class="kw">c</span>(<span class="fl">1.197230052</span>, <span class="fl">1.219771719</span>, <span class="fl">1.102205474</span> , <span class="fl">1.18154867</span>, <span class="fl">1.113341504</span>, <span class="fl">1.29241596</span>, </a>
<a class="sourceLine" id="cb49-25" title="25">            <span class="fl">1.102205474</span>, <span class="fl">1.177562503</span>, <span class="fl">1.114968586</span>, <span class="fl">1.184849704</span>, <span class="fl">1.5</span>, <span class="fl">1.224744381</span>),  </a>
<a class="sourceLine" id="cb49-26" title="26">        <span class="dt">stringsAsFactors=</span><span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb49-27" title="27">    <span class="co">#Calculate hourly mean from original time series, and apply correction factors</span></a>
<a class="sourceLine" id="cb49-28" title="28">      ldf_hourlymean &lt;-<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb49-29" title="29">      <span class="cf">for</span>(station <span class="cf">in</span> ldf){</a>
<a class="sourceLine" id="cb49-30" title="30">        <span class="kw">library</span>(xts)</a>
<a class="sourceLine" id="cb49-31" title="31">        <span class="kw">library</span>(dplyr)</a>
<a class="sourceLine" id="cb49-32" title="32">        select &lt;-<span class="st"> </span>dplyr<span class="op">::</span>select</a>
<a class="sourceLine" id="cb49-33" title="33">        <span class="co">#Create XTS object removing NA values</span></a>
<a class="sourceLine" id="cb49-34" title="34">          myxts =<span class="st"> </span><span class="kw">na.omit</span>(<span class="kw">xts</span>(<span class="dt">x=</span><span class="kw">select</span>(station, valor), <span class="dt">order.by =</span> station<span class="op">$</span>mydatetime))</a>
<a class="sourceLine" id="cb49-35" title="35">        <span class="co">#Conversion to 3-s gust using Durst curve</span></a>
<a class="sourceLine" id="cb49-36" title="36">        <span class="co">#Gust factor from Durst curve equal to 1.52</span></a>
<a class="sourceLine" id="cb49-37" title="37">          myxts<span class="op">$</span>valor =<span class="st"> </span>myxts<span class="op">$</span>valor <span class="op">*</span><span class="st"> </span><span class="fl">1.52</span>  </a>
<a class="sourceLine" id="cb49-38" title="38">        <span class="co">#Correction factor by Roughness</span></a>
<a class="sourceLine" id="cb49-39" title="39">          fczo =<span class="st"> </span>stationssample<span class="op">$</span>fc_zo[stationssample<span class="op">$</span>ideam_id <span class="op">==</span><span class="st"> </span>station<span class="op">$</span>station_id[<span class="dv">1</span>]]</a>
<a class="sourceLine" id="cb49-40" title="40">          myxts<span class="op">$</span>valor =<span class="st"> </span>myxts<span class="op">$</span>valor <span class="op">*</span><span class="st"> </span>fczo</a>
<a class="sourceLine" id="cb49-41" title="41">        <span class="co">#Name of time series is the string &quot;X&quot; + Station ID</span></a>
<a class="sourceLine" id="cb49-42" title="42">          <span class="kw">colnames</span>(myxts) =<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;X&quot;</span>, station<span class="op">$</span>station_id[<span class="dv">1</span>])</a>
<a class="sourceLine" id="cb49-43" title="43">        <span class="co">#Extract index values of last observation of each hour</span></a>
<a class="sourceLine" id="cb49-44" title="44">          endhour =<span class="st"> </span><span class="kw">endpoints</span>(myxts,<span class="dt">on=</span><span class="st">&quot;hours&quot;</span>)</a>
<a class="sourceLine" id="cb49-45" title="45">        <span class="co">#Calculate hourly mean</span></a>
<a class="sourceLine" id="cb49-46" title="46">          myxtshour =<span class="st"> </span>xts<span class="op">::</span><span class="kw">period.apply</span>(myxts, <span class="dt">INDEX=</span>endhour, <span class="dt">FUN=</span>mean)</a>
<a class="sourceLine" id="cb49-47" title="47">        <span class="co">#Rounding time series to previous hour</span></a>
<a class="sourceLine" id="cb49-48" title="48">          <span class="kw">index</span>(myxtshour)=<span class="kw">trunc</span>(<span class="kw">index</span>(myxtshour),<span class="st">&quot;hours&quot;</span>)</a>
<a class="sourceLine" id="cb49-49" title="49">        <span class="co">#Store all standardized time series in ldf_hourlymean</span></a>
<a class="sourceLine" id="cb49-50" title="50">          ldf_hourlymean &lt;-<span class="st"> </span><span class="kw">cbind</span>(ldf_hourlymean, myxtshour)}</a></code></pre></div>

<p>Next code from ISD data source stored in unstacked PostgreSQL table <em>isd_lite_unstack</em>, load twelve stations (using WHERECLAUSE to filter) and apply roughness correction factors. Correction factor values are identical because listed ISD stations are equivalent to the stations listed in the code above. An efficient management of memory is made in the code due to the use of lazy <code>tibble</code> data-frames from PostgreSQL database, see Annex <a href="D-dbstoring.html#dbstoring">D</a> <em><a href="D-dbstoring.html#dbstoring">Database Storing</a></em>.</p>


<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb50-1" title="1">    <span class="co">#Stations IDs and Roughness corrections factors</span></a>
<a class="sourceLine" id="cb50-2" title="2">    stationssample =<span class="st"> </span><span class="kw">data.frame</span>(</a>
<a class="sourceLine" id="cb50-3" title="3">      <span class="dt">isd_usaf_id=</span> <span class="kw">as.character</span>(</a>
<a class="sourceLine" id="cb50-4" title="4">        <span class="kw">c</span>(<span class="dv">803980</span>, <span class="dv">803700</span>, <span class="dv">802110</span>, <span class="dv">802100</span>, <span class="dv">801120</span>, <span class="dv">801100</span>, <span class="dv">800970</span>, <span class="dv">800940</span>, <span class="dv">800630</span>, <span class="dv">800360</span>, <span class="dv">800350</span>, <span class="dv">800280</span>)),</a>
<a class="sourceLine" id="cb50-5" title="5">      <span class="dt">fc_zo =</span> </a>
<a class="sourceLine" id="cb50-6" title="6">        <span class="kw">c</span>(<span class="fl">1.197230052</span>, <span class="fl">1.219771719</span>, <span class="fl">1.102205474</span> , <span class="fl">1.18154867</span>, <span class="fl">1.113341504</span>, <span class="fl">1.29241596</span>, </a>
<a class="sourceLine" id="cb50-7" title="7">          <span class="fl">1.102205474</span>, <span class="fl">1.177562503</span>, <span class="fl">1.114968586</span>, <span class="fl">1.184849704</span>, <span class="fl">1.5</span>, <span class="fl">1.224744381</span>),  </a>
<a class="sourceLine" id="cb50-8" title="8">      <span class="dt">stringsAsFactors=</span><span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb50-9" title="9">    <span class="co">#List of field to read from table, formated with &quot;X&quot; character as column prefix name, </span></a>
<a class="sourceLine" id="cb50-10" title="10">    <span class="co">#and double quotes</span></a>
<a class="sourceLine" id="cb50-11" title="11">      originalfields1 =<span class="st"> </span>stationssample<span class="op">$</span>isd_usaf_id</a>
<a class="sourceLine" id="cb50-12" title="12">      newfields1 =<span class="st"> </span><span class="kw">paste</span> (<span class="st">&quot;X&quot;</span>, originalfields1, <span class="dt">sep=</span><span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb50-13" title="13">      originalfields1 =<span class="st"> </span><span class="kw">paste</span>(<span class="st">&#39;&quot;&#39;</span>, originalfields1, <span class="st">&#39;&quot;&#39;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb50-14" title="14">      newfields1 =<span class="st"> </span><span class="kw">paste</span>(<span class="st">&#39;&quot;&#39;</span>, newfields1, <span class="st">&#39;&quot;&#39;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb50-15" title="15">    <span class="co">#Roughness correction factor</span></a>
<a class="sourceLine" id="cb50-16" title="16">      fczo =<span class="st"> </span>stationssample<span class="op">$</span>fc_zo</a>
<a class="sourceLine" id="cb50-17" title="17">    <span class="co">#Apply roughness correction factor, and</span></a>
<a class="sourceLine" id="cb50-18" title="18">    <span class="co">#force to NULL all values below one</span></a>
<a class="sourceLine" id="cb50-19" title="19">      fiedls_query1 =<span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;CASE WHEN&quot;</span>, originalfields1, <span class="st">&quot;&lt; 1&quot;</span>, <span class="st">&quot;THEN NULL ELSE&quot;</span>, originalfields1,</a>
<a class="sourceLine" id="cb50-20" title="20">       <span class="st">&quot;*&quot;</span>, fczo, <span class="st">&quot;END AS&quot;</span>, newfields1, <span class="dt">sep =</span> <span class="st">&quot; &quot;</span>)</a>
<a class="sourceLine" id="cb50-21" title="21">    <span class="co">#Join datatime field &quot;mydatetime&quot; to the query</span></a>
<a class="sourceLine" id="cb50-22" title="22">      fiedls_query1 =<span class="st"> </span><span class="kw">c</span>(<span class="kw">paste</span>(<span class="st">&#39;&quot;&#39;</span>, <span class="st">&quot;mydatetime&quot;</span>, <span class="st">&#39;&quot;&#39;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>), fiedls_query1)</a>
<a class="sourceLine" id="cb50-23" title="23">      fiedls_query1 =<span class="st"> </span><span class="kw">paste</span> (fiedls_query1, <span class="st">&quot;&quot;</span>, <span class="dt">sep=</span> <span class="st">&quot;&quot;</span>, <span class="dt">collapse=</span><span class="st">&quot;, &quot;</span>)</a>
<a class="sourceLine" id="cb50-24" title="24">    <span class="co">#Construct WHERECLAUSE</span></a>
<a class="sourceLine" id="cb50-25" title="25">      wherestring1 =<span class="st"> </span>stationssample<span class="op">$</span>isd_usaf_id</a>
<a class="sourceLine" id="cb50-26" title="26">      wherestring1 =<span class="st"> </span><span class="kw">paste</span>(<span class="st">&#39;&quot;&#39;</span>, wherestring1, <span class="st">&#39;&quot;&#39;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb50-27" title="27">      <span class="co">#Only take values greater than one and not null</span></a>
<a class="sourceLine" id="cb50-28" title="28">      wherestring1 =<span class="st"> </span><span class="kw">paste</span>(wherestring1, <span class="st">&quot;&gt;= 1 AND&quot;</span>, wherestring1, <span class="st">&quot;IS NOT NULL&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot; &quot;</span>)</a>
<a class="sourceLine" id="cb50-29" title="29">      wherestring1 =<span class="st"> </span><span class="kw">paste</span>(wherestring1, <span class="dt">collapse =</span> <span class="st">&quot;) OR (&quot;</span> , <span class="dt">sep =</span> <span class="st">&quot; &quot;</span>)</a>
<a class="sourceLine" id="cb50-30" title="30">      wherestring1 =<span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;(&quot;</span>, wherestring1, <span class="st">&quot;)&quot;</span>, <span class="dt">sep =</span><span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb50-31" title="31">    <span class="co">#Final query</span></a>
<a class="sourceLine" id="cb50-32" title="32">      query1 =<span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;select&quot;</span>, fiedls_query1, <span class="st">&quot;from isd_lite_unstack&quot;</span>, <span class="st">&quot;where&quot;</span>, wherestring1, <span class="dt">sep=</span><span class="st">&quot; &quot;</span>)</a>
<a class="sourceLine" id="cb50-33" title="33">    <span class="co">#View content of query1, but first split SQL command to show inside PDF document</span></a>
<a class="sourceLine" id="cb50-34" title="34">      mycat &lt;-<span class="st"> </span><span class="cf">function</span>(text){</a>
<a class="sourceLine" id="cb50-35" title="35">        text2 =<span class="st"> </span><span class="kw">gsub</span>(<span class="dt">pattern =</span> <span class="st">&quot;CASE&quot;</span>, <span class="dt">replacement =</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st"> CASE&quot;</span>, <span class="dt">x =</span> text)</a>
<a class="sourceLine" id="cb50-36" title="36">        text3 =<span class="st"> </span><span class="kw">gsub</span>(<span class="dt">pattern =</span> <span class="st">&quot;from&quot;</span>, <span class="dt">replacement =</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st"> from&quot;</span>, <span class="dt">x =</span> text2)</a>
<a class="sourceLine" id="cb50-37" title="37">        <span class="kw">cat</span>(<span class="kw">gsub</span>(<span class="dt">pattern =</span> <span class="st">&quot;OR&quot;</span>, <span class="dt">replacement =</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st"> OR&quot;</span>, <span class="dt">x =</span> text3))}</a>
<a class="sourceLine" id="cb50-38" title="38">      <span class="kw">mycat</span>(query1)        </a></code></pre></div>
<pre><code>select &quot;mydatetime&quot;, 
 CASE WHEN &quot;803980&quot; &lt; 1 THEN NULL ELSE &quot;803980&quot; * 1.197230052 END AS &quot;X803980&quot;, 
 CASE WHEN &quot;803700&quot; &lt; 1 THEN NULL ELSE &quot;803700&quot; * 1.219771719 END AS &quot;X803700&quot;, 
 CASE WHEN &quot;802110&quot; &lt; 1 THEN NULL ELSE &quot;802110&quot; * 1.102205474 END AS &quot;X802110&quot;, 
 CASE WHEN &quot;802100&quot; &lt; 1 THEN NULL ELSE &quot;802100&quot; * 1.18154867 END AS &quot;X802100&quot;, 
 CASE WHEN &quot;801120&quot; &lt; 1 THEN NULL ELSE &quot;801120&quot; * 1.113341504 END AS &quot;X801120&quot;, 
 CASE WHEN &quot;801100&quot; &lt; 1 THEN NULL ELSE &quot;801100&quot; * 1.29241596 END AS &quot;X801100&quot;, 
 CASE WHEN &quot;800970&quot; &lt; 1 THEN NULL ELSE &quot;800970&quot; * 1.102205474 END AS &quot;X800970&quot;, 
 CASE WHEN &quot;800940&quot; &lt; 1 THEN NULL ELSE &quot;800940&quot; * 1.177562503 END AS &quot;X800940&quot;, 
 CASE WHEN &quot;800630&quot; &lt; 1 THEN NULL ELSE &quot;800630&quot; * 1.114968586 END AS &quot;X800630&quot;, 
 CASE WHEN &quot;800360&quot; &lt; 1 THEN NULL ELSE &quot;800360&quot; * 1.184849704 END AS &quot;X800360&quot;, 
 CASE WHEN &quot;800350&quot; &lt; 1 THEN NULL ELSE &quot;800350&quot; * 1.5 END AS &quot;X800350&quot;, 
 CASE WHEN &quot;800280&quot; &lt; 1 THEN NULL ELSE &quot;800280&quot; * 1.224744381 END AS &quot;X800280&quot; 
 from isd_lite_unstack where (&quot;803980&quot; &gt;= 1 AND &quot;803980&quot; IS NOT NULL) 
 OR (&quot;803700&quot; &gt;= 1 AND &quot;803700&quot; IS NOT NULL) 
 OR (&quot;802110&quot; &gt;= 1 AND &quot;802110&quot; IS NOT NULL) 
 OR (&quot;802100&quot; &gt;= 1 AND &quot;802100&quot; IS NOT NULL) 
 OR (&quot;801120&quot; &gt;= 1 AND &quot;801120&quot; IS NOT NULL) 
 OR (&quot;801100&quot; &gt;= 1 AND &quot;801100&quot; IS NOT NULL) 
 OR (&quot;800970&quot; &gt;= 1 AND &quot;800970&quot; IS NOT NULL) 
 OR (&quot;800940&quot; &gt;= 1 AND &quot;800940&quot; IS NOT NULL) 
 OR (&quot;800630&quot; &gt;= 1 AND &quot;800630&quot; IS NOT NULL) 
 OR (&quot;800360&quot; &gt;= 1 AND &quot;800360&quot; IS NOT NULL) 
 OR (&quot;800350&quot; &gt;= 1 AND &quot;800350&quot; IS NOT NULL) 
 OR (&quot;800280&quot; &gt;= 1 AND &quot;800280&quot; IS NOT NULL)</code></pre>

<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb52-1" title="1">    <span class="co">#Connect to Database</span></a>
<a class="sourceLine" id="cb52-2" title="2">      <span class="kw">library</span>(<span class="st">&#39;RPostgreSQL&#39;</span>)</a></code></pre></div>
<pre><code>Loading required package: DBI</code></pre>

<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb54-1" title="1">      pg =<span class="st"> </span><span class="kw">dbDriver</span>(<span class="st">&quot;PostgreSQL&quot;</span>)</a>
<a class="sourceLine" id="cb54-2" title="2">      con1 =<span class="st"> </span><span class="kw">dbConnect</span>(pg, <span class="dt">user=</span><span class="st">&quot;user1&quot;</span>, <span class="dt">password=</span><span class="st">&quot;user1&quot;</span>, <span class="dt">host=</span><span class="st">&quot;localhost&quot;</span>, <span class="dt">port=</span><span class="dv">5432</span>, <span class="dt">dbname=</span><span class="st">&quot;winddata&quot;</span>)</a>
<a class="sourceLine" id="cb54-3" title="3">    <span class="co">#Create tibble dataframe with applied correction factors</span></a>
<a class="sourceLine" id="cb54-4" title="4">      isdlite =<span class="st"> </span><span class="kw">tbl</span>(con1, <span class="kw">sql</span>(query1))</a>
<a class="sourceLine" id="cb54-5" title="5">      <span class="kw">class</span>(isdlite)</a></code></pre></div>
<pre><code>[1] &quot;tbl_PostgreSQLConnection&quot; &quot;tbl_dbi&quot;                 
[3] &quot;tbl_sql&quot;                  &quot;tbl_lazy&quot;                
[5] &quot;tbl&quot;                     </code></pre>

<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb56-1" title="1">      <span class="kw">select</span>(isdlite, <span class="kw">paste0</span>(<span class="st">&quot;X&quot;</span>, stationssample<span class="op">$</span>isd_usaf_id[<span class="dv">6</span><span class="op">:</span><span class="dv">12</span>]))        </a></code></pre></div>
<pre><code># Source:   lazy query [?? x 7]
# Database: postgres 10.0.5 [user1@localhost:5432/winddata]
   X801100 X800970 X800940 X800630 X800360 X800350 X800280
     &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
 1      NA      NA      NA      NA      NA      NA    1.22
 2      NA      NA      NA      NA      NA      NA    6.25
 3      NA      NA      NA      NA      NA      NA    6.25
 4      NA      NA      NA      NA      NA      NA    2.57
 5      NA      NA      NA      NA      NA      NA    3.80
 6      NA      NA      NA      NA      NA      NA    2.57
 7      NA      NA      NA      NA      NA      NA    3.80
 8      NA      NA      NA      NA      NA      NA    1.22
 9      NA      NA      NA      NA      NA      NA    5.02
10      NA      NA      NA      NA      NA      NA    1.22
# ... with more rows</code></pre>

<p>Finally, recommended option to apply correction factors is shown using variable <code>VV_AUT_10</code> (instantaneous wind velocity each ten seconds) from IDEAM data-source. It is based on an Excel file with all correction factors by each station, and time series in text files. In column total correction factor <span class="math inline">\(F_{total}\)</span> of Table <a href="#tab:cf"><strong>??</strong></a>, integrates correction factors due to surface roughness <span class="math inline">\(F_{e}\)</span>, and gust <span class="math inline">\(F_{gust}\)</span>. As it is described in <em><a href="4-rmd-method.html#rmd-standardization">Data Standardization</a></em>, <span class="citation">Lettau (<a href="references.html#ref-Lettau1969" role="doc-biblioref">1969</a>)</span> is applied to calculate <span class="math inline">\(F_e\)</span>, using roughness <span class="math inline">\(Z_o\)</span>, gradient height <span class="math inline">\(Z_g\)</span>, empirical exponent <span class="math inline">\(\alpha\)</span>, and exposure coefficient <span class="math inline">\(K_z\)</span>. For <span class="math inline">\(F_{gust}\)</span>, Durst curve is used, see <em><a href="4-rmd-method.html#rmd-gust">Averaging Time 3-s Gust</a></em>. Despite it is not using lazy <code>tibble</code> data-frames in PostgreSQL, next code uses efficiently memory resources, as it loads only one file time series to memory in a serial iterative process.</p>




<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb58-1" title="1">      <span class="kw">library</span>(xlsx)</a>
<a class="sourceLine" id="cb58-2" title="2">    <span class="co">#Read file with correction factors</span></a>
<a class="sourceLine" id="cb58-3" title="3">      fc &lt;-<span class="kw">read.xlsx</span>(<span class="dt">file=</span><span class="st">&quot;./data/manual/correction_factors_isd_ideam.xlsx&quot;</span>, <span class="dt">sheetName=</span><span class="st">&quot;fc&quot;</span>, <span class="dt">header=</span><span class="ot">TRUE</span>, </a>
<a class="sourceLine" id="cb58-4" title="4">                     <span class="dt">stringsAsFactors =</span> F)</a>
<a class="sourceLine" id="cb58-5" title="5">    <span class="co">#In next folder all text files time series from variable VV_AUT_10 are stored</span></a>
<a class="sourceLine" id="cb58-6" title="6">      path_vv_aut_<span class="dv">10</span> =<span class="st"> &quot;./data/manual/VV_AUT_10/&quot;</span></a>
<a class="sourceLine" id="cb58-7" title="7">    <span class="co">#Read files inside previous folder, with pattern VV_AUT_10@ in the name</span></a>
<a class="sourceLine" id="cb58-8" title="8">      filenames =<span class="st"> </span><span class="kw">list.files</span>(path_vv_aut_<span class="dv">10</span>, <span class="dt">pattern =</span> <span class="st">&quot;VV_AUT_10@&quot;</span>)</a>
<a class="sourceLine" id="cb58-9" title="9">    <span class="co">#Variable to hold station IDs without roughness correction factor</span></a>
<a class="sourceLine" id="cb58-10" title="10">      mymissing =<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb58-11" title="11">    <span class="co">#Do a loop for each &#39;filename&#39; inside &#39;filenames&#39; variable</span></a>
<a class="sourceLine" id="cb58-12" title="12">      <span class="cf">for</span>(filename <span class="cf">in</span> filenames){</a>
<a class="sourceLine" id="cb58-13" title="13">        <span class="co">#Read current filename from disk into memory, variable &#39;dat&#39;</span></a>
<a class="sourceLine" id="cb58-14" title="14">          dat =<span class="st"> </span><span class="kw">read.table</span>(<span class="kw">paste0</span>(path_vv_aut_<span class="dv">10</span>, filename), <span class="dt">header=</span><span class="ot">TRUE</span>, <span class="dt">sep=</span><span class="st">&quot;|&quot;</span>, <span class="dt">stringsAsFactors=</span><span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb58-15" title="15">        <span class="co"># Modify column names</span></a>
<a class="sourceLine" id="cb58-16" title="16">          <span class="kw">names</span>(dat) =<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;fecha&#39;</span>, <span class="st">&#39;valor&#39;</span>)</a>
<a class="sourceLine" id="cb58-17" title="17">        <span class="co">#Take control of possible bad original values</span></a>
<a class="sourceLine" id="cb58-18" title="18">          dat<span class="op">$</span>valor[dat<span class="op">$</span>valor <span class="op">&gt;</span><span class="st"> </span><span class="dv">300</span>] =<span class="st"> </span><span class="ot">NA</span></a>
<a class="sourceLine" id="cb58-19" title="19">          dat<span class="op">$</span>valor[dat<span class="op">$</span>valor <span class="op">&lt;</span><span class="st"> </span><span class="dv">1</span>] =<span class="st"> </span><span class="ot">NA</span></a>
<a class="sourceLine" id="cb58-20" title="20">        <span class="co">#Get station id from current file name</span></a>
<a class="sourceLine" id="cb58-21" title="21">          station_id =<span class="st"> </span><span class="kw">substring</span>(filename, <span class="dv">11</span>, <span class="kw">nchar</span>(filename)<span class="op">-</span><span class="dv">5</span>)  <span class="co">#this is for vv_aut_2</span></a>
<a class="sourceLine" id="cb58-22" title="22">        <span class="co">#Add datetime object</span></a>
<a class="sourceLine" id="cb58-23" title="23">          dat<span class="op">$</span>mydatetime =<span class="st"> </span><span class="kw">as.POSIXct</span>(dat<span class="op">$</span>fecha,<span class="dt">format=</span><span class="st">&quot;%Y-%m-%d %H:%M:%S&quot;</span>, <span class="dt">tz=</span><span class="st">&quot;UTC&quot;</span>)</a>
<a class="sourceLine" id="cb58-24" title="24">        <span class="kw">library</span>(xts)</a>
<a class="sourceLine" id="cb58-25" title="25">        <span class="kw">library</span>(dplyr)</a>
<a class="sourceLine" id="cb58-26" title="26">        select &lt;-<span class="st"> </span>dplyr<span class="op">::</span>select</a>
<a class="sourceLine" id="cb58-27" title="27">        <span class="co">#Create XTS object removing NA values</span></a>
<a class="sourceLine" id="cb58-28" title="28">          myxts =<span class="st"> </span><span class="kw">na.omit</span>(<span class="kw">xts</span>(<span class="dt">x=</span><span class="kw">select</span>(dat, valor), <span class="dt">order.by =</span> dat<span class="op">$</span>mydatetime))</a>
<a class="sourceLine" id="cb58-29" title="29">        <span class="co">#Get correction factor by Roughness</span></a>
<a class="sourceLine" id="cb58-30" title="30">          fexpo =<span class="st"> </span>fc<span class="op">$</span>fexpo[fc<span class="op">$</span>station_id <span class="op">==</span><span class="st"> </span><span class="kw">as.integer</span>(station_id)]  </a>
<a class="sourceLine" id="cb58-31" title="31">        <span class="co">#Keep the record of stations without correction factors in Excel file</span></a>
<a class="sourceLine" id="cb58-32" title="32">          <span class="cf">if</span> (<span class="kw">length</span>(fexpo) <span class="op">==</span><span class="st"> </span><span class="dv">0</span>) {mymissing =<span class="st"> </span><span class="kw">c</span>(mymissing, station<span class="op">$</span>station_id[<span class="dv">1</span>])</a>
<a class="sourceLine" id="cb58-33" title="33">              <span class="kw">cat</span>(<span class="kw">paste</span>(<span class="st">&quot;Station &quot;</span>, station<span class="op">$</span>station_id[<span class="dv">1</span>], <span class="st">&quot;not found in correction factors file&quot;</span>, <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>))}      </a>
<a class="sourceLine" id="cb58-34" title="34">        <span class="co">#Get correction factor by gust</span></a>
<a class="sourceLine" id="cb58-35" title="35">        <span class="co">#All stations are reported in Excel file for gust correction factor</span></a>
<a class="sourceLine" id="cb58-36" title="36">          fgust =<span class="st"> </span>fc<span class="op">$</span>fgust[fc<span class="op">$</span>station_id <span class="op">==</span><span class="st"> </span><span class="kw">as.integer</span>(station<span class="op">$</span>station_id[<span class="dv">1</span>])]            </a>
<a class="sourceLine" id="cb58-37" title="37">        <span class="co">#Apply correction factors</span></a>
<a class="sourceLine" id="cb58-38" title="38">          myxts<span class="op">$</span>valor =<span class="st"> </span>myxts<span class="op">$</span>valor <span class="op">*</span><span class="st"> </span>fexpo <span class="op">*</span><span class="st"> </span>fgust</a>
<a class="sourceLine" id="cb58-39" title="39">        <span class="co">#Name of time series is the string &quot;X&quot; + Station ID</span></a>
<a class="sourceLine" id="cb58-40" title="40">          <span class="kw">colnames</span>(myxts) =<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;X&quot;</span>, station<span class="op">$</span>station_id[<span class="dv">1</span>])</a>
<a class="sourceLine" id="cb58-41" title="41">        <span class="co">#Extract index values of last observation of each hour</span></a>
<a class="sourceLine" id="cb58-42" title="42">          endhour =<span class="st"> </span><span class="kw">endpoints</span>(myxts,<span class="dt">on=</span><span class="st">&quot;hours&quot;</span>)</a>
<a class="sourceLine" id="cb58-43" title="43">        <span class="co">#Calculate hourly mean</span></a>
<a class="sourceLine" id="cb58-44" title="44">          myxtshour =<span class="st"> </span>xts<span class="op">::</span><span class="kw">period.apply</span>(myxts, <span class="dt">INDEX=</span>endhour, <span class="dt">FUN=</span>mean)</a>
<a class="sourceLine" id="cb58-45" title="45">        <span class="co">#Rounding time series to previous hour</span></a>
<a class="sourceLine" id="cb58-46" title="46">          <span class="kw">index</span>(myxtshour)=<span class="kw">trunc</span>(<span class="kw">index</span>(myxtshour),<span class="st">&quot;hours&quot;</span>)</a>
<a class="sourceLine" id="cb58-47" title="47">        <span class="co">#Hourly corrected time series are ready!</span></a>
<a class="sourceLine" id="cb58-48" title="48">        <span class="co">#Proceed to apply next step in methodology: POT-PP</span></a>
<a class="sourceLine" id="cb58-49" title="49">        <span class="co">#...}  </span></a></code></pre></div>

</div>
<div id="downscaling-support" class="section level2">
<h2><span class="header-section-number">F.2</span> Downscaling Support</h2>
<p>Table  shows specific code used to compare all data sources. Complete R code report can be found in Annex <a href="A-rcode.html#rcode">A</a> - Research R Code - Digital Files, Table .</p>


<div id="quality-data-comparison" class="section level3">
<h3><span class="header-section-number">F.2.1</span> Quality Data Comparison</h3>
<p><strong>Procedure to run data comparison using VV_AUT_2 IDEAM variable</strong>:</p>
<p>For this procedure, needed R files are VV_AUT_2_1.r, VV_AUT_2_2.r, and VV_AUT_2_3.r, see Table .</p>
<ol style="list-style-type: decimal">
<li><p>Install R version 3.6.2, RStudio Version 1.2.5033, and 60 R packages dependencies (see chunk of code at beginning of this manual)</p></li>
<li><p>Verify files and variables according to descriptions and recommendations of following list (from 1 to 5), then execute file <strong>VV_AUT_2_1.r</strong>.</p></li>
</ol>
<p>Files to run quality data comparison are inside the folder <em>…/downscaling/qualitydata/</em>. Main file to run this process is <em>VV_AUT_2_1.r</em>, and inside it, next list of variables and code need to be configured:</p>
<ol style="list-style-type: decimal">
<li><em>stationssample</em></li>
</ol>


<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb59-1" title="1">    stationssample =<span class="st"> </span><span class="kw">data.frame</span>(</a>
<a class="sourceLine" id="cb59-2" title="2">      <span class="dt">isd_usaf_id=</span> <span class="kw">as.character</span>(</a>
<a class="sourceLine" id="cb59-3" title="3">        <span class="kw">c</span>(<span class="dv">803980</span>, <span class="dv">803700</span>, <span class="dv">802110</span>, <span class="dv">802100</span>, <span class="dv">801120</span>, <span class="dv">801100</span>, </a>
<a class="sourceLine" id="cb59-4" title="4">          <span class="dv">800970</span>, <span class="dv">800940</span>, <span class="dv">800630</span>, <span class="dv">800360</span>, <span class="dv">800350</span>, <span class="dv">800280</span>)), </a>
<a class="sourceLine" id="cb59-5" title="5">      <span class="dt">ideam_id =</span> <span class="kw">as.character</span>(</a>
<a class="sourceLine" id="cb59-6" title="6">        <span class="kw">c</span>(<span class="dv">48015050</span>, <span class="dv">52055230</span>, <span class="dv">26125061</span>, <span class="dv">26125710</span>, <span class="dv">23085270</span>, <span class="dv">27015330</span>, </a>
<a class="sourceLine" id="cb59-7" title="7">          <span class="dv">16015501</span>, <span class="dv">23195502</span>, <span class="dv">13035501</span>, <span class="dv">28025502</span>, <span class="dv">15065180</span>, <span class="dv">29045190</span>)),</a>
<a class="sourceLine" id="cb59-8" title="8">      <span class="dt">fc_zo =</span> </a>
<a class="sourceLine" id="cb59-9" title="9">        <span class="kw">c</span>(<span class="fl">1.197230052</span>, <span class="fl">1.219771719</span>, <span class="fl">1.102205474</span> , <span class="fl">1.18154867</span>, <span class="fl">1.113341504</span>, <span class="fl">1.29241596</span>, </a>
<a class="sourceLine" id="cb59-10" title="10">          <span class="fl">1.102205474</span>, <span class="fl">1.177562503</span>, <span class="fl">1.114968586</span>, <span class="fl">1.184849704</span>, <span class="fl">1.5</span>, <span class="fl">1.224744381</span>),  </a>
<a class="sourceLine" id="cb59-11" title="11">      <span class="dt">stringsAsFactors=</span><span class="ot">FALSE</span>)</a></code></pre></div>

<p>Inside file <em>VV_AUT_2_1.r</em>, all needed correction factors are hard coded in variable <em>stationssample</em>. If a more suitable calculation of correction factors is done, those values can be updated inside this data-frame.</p>
<ol start="2" style="list-style-type: decimal">
<li><em>path_vv_aut_2</em></li>
</ol>


<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb60-1" title="1">      path_vv_aut_<span class="dv">2</span> =<span class="st"> &quot;./data/manual/VV_AUT_2/&quot;</span></a></code></pre></div>

<p>Inside folder <em>path_vv_aut_2</em>, non-standardized time series text files must be stored (one file per station history). Be aware that all wind velocities must not be standardized. Twelve files are inside this folder, see complete list below.</p>


<div class="sourceCode" id="cb61"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb61-1" title="1">      <span class="ex">VV_AUT_2@13035501.data</span></a>
<a class="sourceLine" id="cb61-2" title="2">      <span class="ex">VV_AUT_2@15065180.data</span></a>
<a class="sourceLine" id="cb61-3" title="3">      <span class="ex">VV_AUT_2@16015501.data</span></a>
<a class="sourceLine" id="cb61-4" title="4">      <span class="ex">VV_AUT_2@23085270.data</span></a>
<a class="sourceLine" id="cb61-5" title="5">      <span class="ex">VV_AUT_2@23195502.data</span></a>
<a class="sourceLine" id="cb61-6" title="6">      <span class="ex">VV_AUT_2@26125061.data</span></a>
<a class="sourceLine" id="cb61-7" title="7">      <span class="ex">VV_AUT_2@26125710.data</span></a>
<a class="sourceLine" id="cb61-8" title="8">      <span class="ex">VV_AUT_2@27015330.data</span></a>
<a class="sourceLine" id="cb61-9" title="9">      <span class="ex">VV_AUT_2@28025502.data</span></a>
<a class="sourceLine" id="cb61-10" title="10">      <span class="ex">VV_AUT_2@29045190.data</span></a>
<a class="sourceLine" id="cb61-11" title="11">      <span class="ex">VV_AUT_2@48015050.data</span></a>
<a class="sourceLine" id="cb61-12" title="12">      <span class="ex">VV_AUT_2@52055230.data</span></a></code></pre></div>

<p>Files names must follow this convention <strong>VV_AUT_2@*.data</strong>, where <em>*</em> is the IDEAM station ID. Content of each file must follow structure shown below.</p>


<div class="sourceCode" id="cb62"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb62-1" title="1">      <span class="ex">Fecha</span><span class="kw">|</span><span class="ex">Valor</span></a>
<a class="sourceLine" id="cb62-2" title="2">      <span class="ex">2015-05-30</span> 17:20:00<span class="kw">|</span><span class="ex">0.2</span></a>
<a class="sourceLine" id="cb62-3" title="3">      <span class="ex">2015-05-30</span> 17:22:00<span class="kw">|</span><span class="ex">0.1</span></a>
<a class="sourceLine" id="cb62-4" title="4">      <span class="ex">2015-05-30</span> 17:26:00<span class="kw">|</span><span class="ex">0.1</span></a>
<a class="sourceLine" id="cb62-5" title="5">      <span class="ex">2015-05-30</span> 17:28:00<span class="kw">|</span><span class="ex">0.2</span></a>
<a class="sourceLine" id="cb62-6" title="6">      <span class="ex">2015-05-30</span> 17:30:00<span class="kw">|</span><span class="ex">0.4</span></a>
<a class="sourceLine" id="cb62-7" title="7">      <span class="ex">2015-05-30</span> 17:32:00<span class="kw">|</span><span class="ex">0.2</span></a>
<a class="sourceLine" id="cb62-8" title="8">      <span class="ex">2015-05-30</span> 17:34:00<span class="kw">|</span><span class="ex">0.2</span></a>
<a class="sourceLine" id="cb62-9" title="9">      <span class="ex">...</span></a></code></pre></div>

<p>The first line must contain the text <em>Fecha|Valor</em> representing two column names, first column <em>Fecha</em> has the date time in the format “YYYY-MM-DD HH:MM:SS” (time zone UTC), and second column <em>Valor</em> must have the non-standardized wind velocity in kilometers per hour. Separation of each column value must be the <em>|</em> character.</p>
<ol start="3" style="list-style-type: decimal">
<li><em>con1</em></li>
</ol>


<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb63-1" title="1">      con1 =<span class="st"> </span><span class="kw">dbConnect</span>(pg, <span class="dt">user=</span><span class="st">&quot;user1&quot;</span>, <span class="dt">password=</span><span class="st">&quot;user1&quot;</span>, <span class="dt">host=</span><span class="st">&quot;localhost&quot;</span>, <span class="dt">port=</span><span class="dv">5432</span>, <span class="dt">dbname=</span><span class="st">&quot;winddata&quot;</span>)</a></code></pre></div>

<p>In variable <em>con1</em> all PostgreSQL database credentials are defined. Tables to use are <em>isd_all_stations</em>, and <em>ideam_all_stations</em>, corresponding to ISD and IDEAM stations catalogs, and <em>isd_lite_unstack</em> corresponding to ISD unstacked time series. Verify values in <em>con1</em> according to current database configuration.</p>
<ol start="4" style="list-style-type: decimal">
<li><em>VV_AUT_2_2.r</em> and <em>VV_AUT_2_3.r</em></li>
</ol>


<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb64-1" title="1">      <span class="kw">source</span>(<span class="st">&#39;VV_AUT_2_2.r&#39;</span>)</a>
<a class="sourceLine" id="cb64-2" title="2">      ...</a>
<a class="sourceLine" id="cb64-3" title="3">      <span class="kw">source</span>(<span class="st">&#39;VV_AUT_2_3.r&#39;</span>)</a></code></pre></div>

<p>Inside files <em>VV_AUT_2_2.r</em> and <em>VV_AUT_2_3.r</em> all code to read ERA5 dataset is defined. The most important line there, defines the location of NetCDF file <em>outfile_nc4c_zip9.nc</em> with variable <em>fg10</em> (3-s wind gust). Be sure that <em>ncname</em> (shown below) variable is pointing to the right place where NetCDF file is stored.</p>


<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb65-1" title="1">      (ncname &lt;-<span class="st"> &quot;../data/outfile_nc4c_zip9&quot;</span>)</a></code></pre></div>

<ol start="5" style="list-style-type: decimal">
<li><em>somePDFPath</em></li>
</ol>


<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb66-1" title="1">      somePDFPath =<span class="st"> </span><span class="kw">paste</span>(<span class="kw">paste</span>(<span class="st">&quot;isdideamera5&quot;</span>, i, statideam, <span class="dt">sep =</span> <span class="st">&quot;_&quot;</span>), <span class="st">&quot;pdf&quot;</span>, <span class="dt">sep=</span><span class="st">&quot;.&quot;</span>)</a></code></pre></div>

<p>Variable <em>somePDFPath</em> holds the name of the PDF file with the quality data comparison between IDEAM, ISD and ERA5. After execution, there will be a file for each station provided in data frame <em>stationssample</em>. Inside each PDF file, comparison time series graphics are provided, as well as scatter plots. Using graphics inside this file, it is possible to visually define if exist downscaling support to use model or forecast data (ISD and ERA5), by the comparison against measure data (IDEAM). See Table <a href="#tab:resultsstructure"><strong>??</strong></a> in Annex <em><a href="B-results.html#results">Results - Digital Files</a></em>, for a description of all digital output files of this research.</p>
</div>
<div id="non-quality-data-comparison" class="section level3">
<h3><span class="header-section-number">F.2.2</span> Non-quality Data Comparison</h3>
<p><strong>Procedure to run data comparison using VV_AUT_10 IDEAM variable</strong>:</p>
<p>For this procedure, needed R file is VV_AUT_10.r, see Table .</p>
<ol style="list-style-type: decimal">
<li><p>Install R version 3.6.2, RStudio Version 1.2.5033, and 60 R packages dependencies (see chunk of code at beginning of this manual)</p></li>
<li><p>Verify files and variables according to descriptions and recommendations of following list (from 1 to 6), then execute file <strong>VV_AUT_10.r</strong>.</p></li>
</ol>
<p>Inside the folder <em>…/downscaling/nonqualitydata/</em>, it is possible to find files to run non-quality data comparison. Main file to run this process is <em>VV_AUT_10.r</em>, and inside it, next list of variables and code need to be configured:</p>
<ol style="list-style-type: decimal">
<li><em>con1</em></li>
</ol>


<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb67-1" title="1">      con1 =<span class="st"> </span><span class="kw">dbConnect</span>(pg, <span class="dt">user=</span><span class="st">&quot;user1&quot;</span>, <span class="dt">password=</span><span class="st">&quot;user1&quot;</span>, <span class="dt">host=</span><span class="st">&quot;localhost&quot;</span>, <span class="dt">port=</span><span class="dv">5432</span>, <span class="dt">dbname=</span><span class="st">&quot;winddata&quot;</span>)</a></code></pre></div>

<p>In variable <em>con1</em> all PostgreSQL database credentials are defined. Tables to use are <em>isd_all_stations</em>, and <em>ideam_all_stations</em>, corresponding to ISD and IDEAM stations catalogs, and <em>isd_lite_unstack</em> corresponding to ISD unstacked time series. Verify values in <em>con1</em> according to current database configuration.</p>
<ol start="2" style="list-style-type: decimal">
<li><em>stationssample</em></li>
</ol>


<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb68-1" title="1">    stationssample =<span class="st"> </span><span class="kw">data.frame</span>(</a>
<a class="sourceLine" id="cb68-2" title="2">      <span class="dt">isd_usaf_id=</span> <span class="kw">as.character</span>(</a>
<a class="sourceLine" id="cb68-3" title="3">        <span class="kw">c</span>(<span class="dv">803980</span>, <span class="dv">803700</span>, <span class="dv">802110</span>, <span class="dv">802100</span>, <span class="dv">801120</span>, <span class="dv">801100</span>, </a>
<a class="sourceLine" id="cb68-4" title="4">          <span class="dv">800970</span>, <span class="dv">800940</span>, <span class="dv">800630</span>, <span class="dv">800360</span>, <span class="dv">800350</span>, <span class="dv">800280</span>)), </a>
<a class="sourceLine" id="cb68-5" title="5">      <span class="dt">ideam_id =</span> <span class="kw">as.character</span>(</a>
<a class="sourceLine" id="cb68-6" title="6">        <span class="kw">c</span>(<span class="dv">48015050</span>, <span class="dv">52055230</span>, <span class="dv">26125061</span>, <span class="dv">26125710</span>, <span class="dv">23085270</span>, <span class="dv">27015330</span>, </a>
<a class="sourceLine" id="cb68-7" title="7">          <span class="dv">16015501</span>, <span class="dv">23195502</span>, <span class="dv">13035501</span>, <span class="dv">28025502</span>, <span class="dv">15065180</span>, <span class="dv">29045190</span>)),</a>
<a class="sourceLine" id="cb68-8" title="8">      <span class="dt">fc_zo =</span> </a>
<a class="sourceLine" id="cb68-9" title="9">        <span class="kw">c</span>(<span class="fl">1.197230052</span>, <span class="fl">1.219771719</span>, <span class="fl">1.102205474</span> , <span class="fl">1.18154867</span>, <span class="fl">1.113341504</span>, <span class="fl">1.29241596</span>, </a>
<a class="sourceLine" id="cb68-10" title="10">          <span class="fl">1.102205474</span>, <span class="fl">1.177562503</span>, <span class="fl">1.114968586</span>, <span class="fl">1.184849704</span>, <span class="fl">1.5</span>, <span class="fl">1.224744381</span>),  </a>
<a class="sourceLine" id="cb68-11" title="11">      <span class="dt">stringsAsFactors=</span><span class="ot">FALSE</span>)</a></code></pre></div>

<p>Inside file <em>VV_AUT_2_1.r</em>, all needed correction factors are hard coded in variable <em>stationssample</em>. If a more suitable calculation of correction factors is done, those values can be updated inside this data-frame.</p>
<ol start="3" style="list-style-type: decimal">
<li><em>ncname</em></li>
</ol>


<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb69-1" title="1">      ncname &lt;-<span class="st"> &quot;../data/outfile_nc4c_zip9&quot;</span></a></code></pre></div>

<p>Variable <em>ncname</em>, defines the location of NetCDF file <em>outfile_nc4c_zip9.nc</em> with variable <em>fg10</em> (3-s wind gust). Be sure that <em>ncname</em> variable is pointing to the right place where mentioned NetCDF file is stored.</p>
<ol start="4" style="list-style-type: decimal">
<li><em>fc</em></li>
</ol>


<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb70-1" title="1">      fc &lt;-<span class="kw">read.xlsx</span>(<span class="dt">file=</span><span class="st">&quot;correction_factors_isd_ideam.xlsx&quot;</span>, <span class="dt">sheetName=</span><span class="st">&quot;fc&quot;</span>, <span class="dt">header=</span><span class="ot">TRUE</span>, </a>
<a class="sourceLine" id="cb70-2" title="2">                     <span class="dt">stringsAsFactors =</span> F)</a></code></pre></div>

<p>Variable <em>fc</em> must point to Excel file where correction factors and dependent variables are stored for each analyzed ISD and IDEAM station. This file must have columns <em>Station ID</em>, roughness <span class="math inline">\(Z_o\)</span>, <em>Source</em>, gradient height <span class="math inline">\(Z_g\)</span>, empirical exponent <span class="math inline">\(\alpha\)</span>, exposure coefficient <span class="math inline">\(K_z\)</span>, exposition correction factor <span class="math inline">\(F_e\)</span>, gust correction factor <span class="math inline">\(F_{gust}\)</span>, and total correction factor <span class="math inline">\(F_{total}\)</span>, as is shown in Table <a href="#tab:cf"><strong>??</strong></a>. For a detailed explanation, see <em><a href="4-rmd-method.html#rmd-standardization">Data Standardization</a></em>.</p>
<ol start="5" style="list-style-type: decimal">
<li><em>path_vv_aut_10</em></li>
</ol>


<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb71-1" title="1">      path_vv_aut_<span class="dv">10</span> =<span class="st"> &quot;./data/manual/VV_AUT_10/&quot;</span></a></code></pre></div>

<p>Non standardized time series text files for IDEAM data VV_AUT_10 - instantaneous wind velocity each ten (10) minutes, must be stored inside folder <em>path_vv_aut_10</em>, one file per station history. Be aware that all wind velocities must not be standardized. There are a total of 204 stations, that is 204 files. The file name follows the format <em>VV_AUT_10@*.data</em>, where * is replaced by the station identifier, as can be seen below.</p>


<div class="sourceCode" id="cb72"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb72-1" title="1">      <span class="ex">VV_AUT_10@31095030.data</span></a>
<a class="sourceLine" id="cb72-2" title="2">      <span class="ex">VV_AUT_10@29065130.data</span></a>
<a class="sourceLine" id="cb72-3" title="3">      <span class="ex">VV_AUT_10@29065140.data</span></a>
<a class="sourceLine" id="cb72-4" title="4">      <span class="ex">...</span></a></code></pre></div>

<p>Content of each file must follow structure shown below. The first line must contain the text <em>Fecha|Valor</em>, representing two column names, first column <em>Fecha</em>, has the date time in the format “YYYY-MM-DD HH:MM:SS” (time zone UTC), and second column <em>Valor</em> must have the non-standardized wind velocity in kilometers per hour. Separation of each column value must be the <em>|</em> character.</p>


<div class="sourceCode" id="cb73"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb73-1" title="1">      <span class="ex">Fecha</span><span class="kw">|</span><span class="ex">Valor</span></a>
<a class="sourceLine" id="cb73-2" title="2">      <span class="ex">2008-10-29</span> 10:30:00<span class="kw">|</span><span class="ex">0.9</span></a>
<a class="sourceLine" id="cb73-3" title="3">      <span class="ex">2008-10-29</span> 10:40:00<span class="kw">|</span><span class="ex">1.4</span></a>
<a class="sourceLine" id="cb73-4" title="4">      <span class="ex">2008-10-29</span> 10:50:00<span class="kw">|</span><span class="ex">1.2</span></a>
<a class="sourceLine" id="cb73-5" title="5">      <span class="ex">...</span></a></code></pre></div>

<ol start="6" style="list-style-type: decimal">
<li><em>somePDFPath</em></li>
</ol>


<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb74-1" title="1">      somePDFPath =<span class="st"> </span><span class="kw">paste</span>(<span class="kw">paste</span>(<span class="st">&quot;isdideamera5&quot;</span>, i, era5_intersect_ideam[<span class="st">&quot;ideam_station&quot;</span>,i], <span class="dt">sep =</span> <span class="st">&quot;_&quot;</span>), </a>
<a class="sourceLine" id="cb74-2" title="2">                          <span class="st">&quot;pdf&quot;</span>, <span class="dt">sep=</span><span class="st">&quot;.&quot;</span>)</a></code></pre></div>

<p>Variable <em>somePDFPath</em> holds the name of the output PDF file with non-quality data comparison between IDEAM, ISD and ERA5. After execution, there will be a file for each match between ERA5 cells and ISD and/or IDEAM intersecting stations. Inside each PDF file, comparison time series graphics will be generated, as well as scatter plots. Using graphics inside this file, it is possible to visually define if exist downscaling support to use model or forecast data (ISD and ERA5), by the comparison against measure data (IDEAM). See Table <a href="#tab:resultsstructure"><strong>??</strong></a> <em><a href="B-results.html#results">Results - Digital Files</a></em>, for a description of all digital output files of this research.</p>
</div>
</div>
<div id="pot-pp-1" class="section level2">
<h2><span class="header-section-number">F.3</span> POT-PP</h2>
<div id="isd-1" class="section level3">
<h3><span class="header-section-number">F.3.1</span> ISD</h3>
<p>Table  shows specific POT-PP R code used for ISD stations. Complete R code report can be found in Table  of Annex <a href="A-rcode.html#rcode">A</a>.</p>


<p><strong>Procedure to run POT-PP in ISD stations</strong>:</p>
<ol style="list-style-type: decimal">
<li><p>Install R version 3.6.2, RStudio Version 1.2.5033, and 60 R packages dependencies (see chunk of code at beginning of this manual)</p></li>
<li><p>Verify files and variables according to descriptions and recommendations of following list (from 1 to 4), then execute file <strong>pot_pp_isd.r</strong>.</p></li>
</ol>
<p>Files to run POT-PP in ISD stations are inside the folder <em>…/pot_pp/isd/</em>. Main file to run this process is <strong>pot_pp_isd.r</strong>, and inside it, next list of variables need to be configured.</p>
<ol style="list-style-type: decimal">
<li><em>inputpath</em></li>
</ol>


<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb75-1" title="1">      inputpath=<span class="st">&quot;./raw_data/&quot;</span></a></code></pre></div>

<p>Inside this folder <em>inputpath</em>, standardized time series text files must be stored, one file per station history. Be aware that all wind velocities must be already standardized, see <em><a href="4-rmd-method.html#rmd-standardization">Data Standardization</a></em> section in <em><a href="4-rmd-method.html#rmd-method">Methodology</a></em>. Below, an example of the content of this folder is shown.</p>


<div class="sourceCode" id="cb76"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb76-1" title="1">      <span class="ex">raw_data_station_800740.txt</span></a>
<a class="sourceLine" id="cb76-2" title="2">      <span class="ex">raw_data_station_800770.txt</span></a>
<a class="sourceLine" id="cb76-3" title="3">      <span class="ex">...</span></a></code></pre></div>

<p>Files names must follow this convention <strong>raw_data_station_*.txt</strong>, where <em>*</em> must be replaced by the station ID. Its content must follow structure shown below.</p>


<div class="sourceCode" id="cb77"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb77-1" title="1">      <span class="st">&quot;date_time&quot;</span> <span class="st">&quot;kph&quot;</span> <span class="st">&quot;thunder_flag&quot;</span></a>
<a class="sourceLine" id="cb77-2" title="2">      <span class="st">&quot;1950/06/22 12:00:00 GMT&quot;</span>  <span class="ex">122.60934</span> <span class="st">&quot;nt&quot;</span></a>
<a class="sourceLine" id="cb77-3" title="3">      <span class="st">&quot;1951/06/13 12:00:00 GMT&quot;</span>   <span class="ex">203.9521</span> <span class="st">&quot;nt&quot;</span></a>
<a class="sourceLine" id="cb77-4" title="4">      <span class="st">&quot;1951/08/02 12:00:00 GMT&quot;</span>  <span class="ex">30.553136</span> <span class="st">&quot;nt&quot;</span></a>
<a class="sourceLine" id="cb77-5" title="5">      <span class="st">&quot;1963/02/26 12:00:00 GMT&quot;</span>  <span class="ex">26.585196</span> <span class="st">&quot;nt&quot;</span></a>
<a class="sourceLine" id="cb77-6" title="6">      <span class="ex">...</span></a></code></pre></div>

<p>The first line must contain the text <em>“date_time” “mph” “thunder_flag”</em>, representing three column names separated by spaces. First column <em>“date_time”</em> has the date time in the format “YYYY/MM/DD HH:MM:SS” (time zone UTC). Second column <em>kph</em> must have the standardized wind velocity in kilometers per hour. Third column <em>“thunder_flag”</em> must have a flag with one of two possible values <em>“nt”</em> or <em>“t”</em>, representing <em>non-thunderstorm</em> or <em>thunderstorm</em> classification respectively for the current wind value. For current research third column always had the flag <em>“nt”</em> (all stations, all rows). Separation of each column value must be <em>space</em> character. Values corresponding to <em>“date_time”</em> and <em>“thunder_flag”</em> must be enclosed by double quotes.</p>
<ol start="2" style="list-style-type: decimal">
<li><em>estaciones</em></li>
</ol>


<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb78-1" title="1">      estaciones &lt;-<span class="st"> </span><span class="kw">read.delim</span>(<span class="kw">paste0</span>(inputpath, <span class="st">&quot;01 estaciones.txt&quot;</span>), </a>
<a class="sourceLine" id="cb78-2" title="2">        <span class="dt">header =</span> <span class="ot">FALSE</span>, <span class="dt">sep =</span> <span class="st">&quot;</span><span class="ch">\t</span><span class="st">&quot;</span>)</a></code></pre></div>

<p>Variable <em>estaciones</em>, must point to a text file, named <em>‘01 estaciones.txt’</em>, and stored inside <em>inputpath</em> folder, with the IDs of ISD stations to be processed. Each line of the file must have one ISD station ID. This file must have the list of stations to process, one station per row. If the intention is to run the process for only one station, the content of this file must have a single line, with the corresponding station ID. The code repeats the POT-PP procedure for each line of this file. Below, an example of its content is shown.</p>


<div class="sourceCode" id="cb79"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb79-1" title="1">      <span class="ex">800740</span></a>
<a class="sourceLine" id="cb79-2" title="2">      <span class="ex">800770</span></a>
<a class="sourceLine" id="cb79-3" title="3">      <span class="ex">...</span></a></code></pre></div>

<p>Be aware that for each line in this file <em>01 estaciones.txt</em>, one text file with wind historical time series information, named <strong>raw_data_station_*.txt</strong>, where <em>*</em> represents the same station ID, must be stored inside <em>inputpath</em> folder. See first element, lines up, in this list of variables.</p>
<ol start="3" style="list-style-type: decimal">
<li><em>outputpath</em></li>
</ol>


<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb80-1" title="1">      outputpath =<span class="st"> &quot;./isd/&quot;</span></a></code></pre></div>

<p>Variable <em>outputpath</em>, should point to the folder where all output files will be stored, after running POT-PP process. The following list describes the main files to be generated, where <em>*</em> will be replaced by correspondent station ID.</p>
<ul>
<li><em>FittedModel_*.pdf</em>: ISD POT-PP output graphics. See Table .</li>
<li><em>fitted_model_result.xlsx</em>: Return levels ISD (all stations). See Table .</li>
<li><em>raw_data_station_*_fitted.xlsx</em>: ISD POT-PP output parameters by station. See Table .</li>
<li><em>raw_data_station_*_statistics.xlsx</em>: ISD POT-PP time (year, month, week) statistics by station. See Table .</li>
</ul>
<p>Table  shows <strong>input</strong> and <strong>output</strong> files for ISD stations, after running POT-PP. See Annex <a href="B-results.html#results">B</a> - Results - Digital Files, Table , for a complete report of research files.</p>


<ol start="4" style="list-style-type: decimal">
<li>Linked R code</li>
</ol>
<p>Main file <strong>pot_pp_isd.r</strong>, runs supplemental code using the R command <em>source</em>. Be sure that all R code files listed in next chunk of code, are pointing to the right location. See Table  with the description of POT-PP ERA5 complementary R files. In the Table  of the Annex <a href="A-rcode.html#rcode">A</a> it is possible to see all R files related to this research.</p>


<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb81-1" title="1">    <span class="co">#Library of POT-PP functions, including Dr Adam Pintar R Code (not </span></a>
<a class="sourceLine" id="cb81-2" title="2">    <span class="co">#published because this is copyrighted)</span></a>
<a class="sourceLine" id="cb81-3" title="3">      <span class="kw">source</span>(<span class="st">&#39;./code/function_lib.R&#39;</span>)</a>
<a class="sourceLine" id="cb81-4" title="4">    <span class="co">#Raw Data (whole dataset) Statistics and Send to CSV </span></a>
<a class="sourceLine" id="cb81-5" title="5">      <span class="kw">source</span>(<span class="st">&#39;./code/stats_raw_data.r&#39;</span>)</a>
<a class="sourceLine" id="cb81-6" title="6">    <span class="co">#Non Thunderstorm - Create Raw Data Statistics and Send to CSV </span></a>
<a class="sourceLine" id="cb81-7" title="7">      <span class="kw">source</span>(<span class="st">&#39;./code/stats_raw_data_nt.r&#39;</span>)</a>
<a class="sourceLine" id="cb81-8" title="8">    <span class="co">#Thunderstorm - Create Raw Data Statistics and Send to CSV</span></a>
<a class="sourceLine" id="cb81-9" title="9">      <span class="kw">source</span>(<span class="st">&#39;./code/stats_raw_data_t.r&#39;</span>)</a>
<a class="sourceLine" id="cb81-10" title="10">    <span class="co">#Write &quot;t&quot; to csv, but changing to one data per day (the maximum)</span></a>
<a class="sourceLine" id="cb81-11" title="11">    <span class="co">#Write &quot;nt&quot; to csv, but changing to one data per day (the maximum)</span></a>
<a class="sourceLine" id="cb81-12" title="12">      <span class="kw">source</span>(<span class="st">&#39;./code/tnt_csv_1perday.r&#39;</span>)</a>
<a class="sourceLine" id="cb81-13" title="13">    <span class="co">#Statistics and graphics for de-clustered non-thunderstorm</span></a>
<a class="sourceLine" id="cb81-14" title="14">      <span class="kw">source</span>(<span class="st">&#39;./code/stats_graphs_dnt.r&#39;</span>)</a>
<a class="sourceLine" id="cb81-15" title="15">    <span class="co">#Statistics and graphics for de-clustered thunderstorm</span></a>
<a class="sourceLine" id="cb81-16" title="16">      <span class="kw">source</span>(<span class="st">&#39;./code/stats_graphs_dt.r&#39;</span>)</a>
<a class="sourceLine" id="cb81-17" title="17">    <span class="co">#Plots for thunderstorm</span></a>
<a class="sourceLine" id="cb81-18" title="18">      <span class="kw">source</span>(<span class="st">&#39;./code/plot_t.r&#39;</span>)</a>
<a class="sourceLine" id="cb81-19" title="19">    <span class="co">#Plots for non-thunderstorm</span></a>
<a class="sourceLine" id="cb81-20" title="20">      <span class="kw">source</span>(<span class="st">&#39;./code/plot_nt.r&#39;</span>)</a>
<a class="sourceLine" id="cb81-21" title="21">    <span class="co">#Plots for non-thunderstorm and thunderstorm</span></a>
<a class="sourceLine" id="cb81-22" title="22">      <span class="kw">source</span>(<span class="st">&#39;./code/plot_t_nt.r&#39;</span>)</a></code></pre></div>

<div id="isd-maps" class="section level4">
<h4><span class="header-section-number">F.3.1.1</span> ISD Maps</h4>
<p>Main output file of POT-PP analysis is <em>fitted_model_result.xlsx</em>, which contains return levels for typical return periods. Inside this Excel book, sheet <em>pp_pintar</em>, use columns <em>43 to 53</em>, to create extreme wind maps. Name of those columns are <em>nt_*_poissonprocessintfunc</em>, corresponding to non-thunderstorm return levels using Poisson Process Intensity Function, where * is replaced for 10, 20, 50, 100, 250, 500, 700, 1000, 1700, 3000, and 7000 years. A detailed description of all columns of <em>fitted_model_result.xlsx</em>, can be found in Table .</p>
<p>To create non-hurricane maps using Kriging, from columns 43 to 53 of file <em>fitted_model_result.xlsx</em>, use R files inside folder <em>…/code/pot_pp/isd/maps/</em>, see Table . For instance, to create non-hurricane map with return levels for 10 years MRI, use file <em>rl_10_nh.r</em>, for 50 MRI use <em>rl_50_nh.r</em>, and in the same way for other return periods. Once GeoTIFF images have been created with previous R files, use <em>plot_maps.r</em> to plot maps using <code>ggplot2</code> R package.</p>
<p>Inside files <em>rl_*_nh.r</em> different types of geostatistical related analysis are coded, mainly using <code>gstat</code> <span class="citation">(E. Pebesma &amp; Graeler, <a href="references.html#ref-Pebesma2019" role="doc-biblioref">2019</a>)</span>, <code>sf</code> <span class="citation">(E. Pebesma, <a href="references.html#ref-Pebesma2019a" role="doc-biblioref">2019</a><a href="references.html#ref-Pebesma2019a" role="doc-biblioref">a</a>)</span>, and <code>stars</code> <span class="citation">(E. Pebesma, <a href="references.html#ref-Pebesma2019b" role="doc-biblioref">2019</a><a href="references.html#ref-Pebesma2019b" role="doc-biblioref">b</a>)</span> R packages.</p>
<ul>
<li>Experimental semivariogram</li>
<li>Directional semivariograms</li>
<li>Theoretical semivariograms</li>
<li>Graphics of semivariance models</li>
<li>First-order trend modeling</li>
<li>Graphics of semivariance models - first order trend</li>
<li>Ordinary Kriging estimation</li>
<li>Simple Kriging estimation</li>
<li>Universal Kriging estimation</li>
<li>Graphics of Kriging predictions &amp; errors</li>
<li>Cross validation - ‘leave-one-out’</li>
<li>Cross validation - ‘N-fold’</li>
<li>Cross validation - comparison statistics</li>
<li>Final map - predictions</li>
<li>Final map - errors</li>
<li>IDW &amp; cross validation</li>
</ul>
<p><strong>Procedure to create non-hurricane maps</strong>:</p>
<ol style="list-style-type: decimal">
<li><p>Run the procedure previously described in this manual, to execute POT-PP in ISD stations. File <em>fitted_model_result.xlsx</em> will be created with all return levels for different return periods.</p></li>
<li><p>From file <em>fitted_model_result.xlsx</em>, create file <em>rlisd.xlsx</em> with 20 columns according to Table <a href="F-manual.html#tab:rlisd">F.1</a>. See Table  for columns descriptions. Keep same number of records in <em>rlisd.xlsx</em> compared with <em>fitted_model_result.xlsx</em>.</p></li>
</ol>
<table class="table" style="font-size: 8px; margin-left: auto; margin-right: auto;">
<caption style="font-size: initial !important;">
<span id="tab:rlisd">Table F.1: </span>Creation of File rlisd.xlsx
</caption>
<thead>
<tr>
<th style="border-bottom:hidden; padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="2">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
File fitted_model_result.xlsx
</div>
</th>
<th style="border-bottom:hidden; padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="2">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
File rlisd.xlsx
</div>
</th>
</tr>
<tr>
<th style="text-align:left;text-align: left;">
Column ID
</th>
<th style="text-align:left;text-align: left;">
Column Name
</th>
<th style="text-align:left;text-align: left;">
Column ID
</th>
<th style="text-align:left;text-align: left;">
Column Name
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;width: 0.5in; ">
1
</td>
<td style="text-align:left;width: 1.5in; ">
id
</td>
<td style="text-align:left;width: 0.5in; ">
1
</td>
<td style="text-align:left;width: 1.5in; ">
id
</td>
</tr>
<tr>
<td style="text-align:left;width: 0.5in; ">
2
</td>
<td style="text-align:left;width: 1.5in; ">
t_thresh
</td>
<td style="text-align:left;width: 0.5in; ">
2
</td>
<td style="text-align:left;width: 1.5in; ">
t_thresh
</td>
</tr>
<tr>
<td style="text-align:left;width: 0.5in; ">
3
</td>
<td style="text-align:left;width: 1.5in; ">
t_mu_location
</td>
<td style="text-align:left;width: 0.5in; ">
3
</td>
<td style="text-align:left;width: 1.5in; ">
t_mu_location
</td>
</tr>
<tr>
<td style="text-align:left;width: 0.5in; ">
4
</td>
<td style="text-align:left;width: 1.5in; ">
t_psi_scale
</td>
<td style="text-align:left;width: 0.5in; ">
4
</td>
<td style="text-align:left;width: 1.5in; ">
t_psi_scale
</td>
</tr>
<tr>
<td style="text-align:left;width: 0.5in; ">
5
</td>
<td style="text-align:left;width: 1.5in; ">
nt_thresh
</td>
<td style="text-align:left;width: 0.5in; ">
5
</td>
<td style="text-align:left;width: 1.5in; ">
nt_thresh
</td>
</tr>
<tr>
<td style="text-align:left;width: 0.5in; ">
6
</td>
<td style="text-align:left;width: 1.5in; ">
nt_mu_location
</td>
<td style="text-align:left;width: 0.5in; ">
6
</td>
<td style="text-align:left;width: 1.5in; ">
nt_mu_location
</td>
</tr>
<tr>
<td style="text-align:left;width: 0.5in; ">
7
</td>
<td style="text-align:left;width: 1.5in; ">
nt_psi_scale
</td>
<td style="text-align:left;width: 0.5in; ">
7
</td>
<td style="text-align:left;width: 1.5in; ">
nt_psi_scale
</td>
</tr>
<tr>
<td style="text-align:left;width: 0.5in; ">
8
</td>
<td style="text-align:left;width: 1.5in; ">
distance_w
</td>
<td style="text-align:left;width: 0.5in; ">
8
</td>
<td style="text-align:left;width: 1.5in; ">
distance_w
</td>
</tr>
<tr>
<td style="text-align:left;width: 0.5in; ">
9
</td>
<td style="text-align:left;width: 1.5in; ">
station
</td>
<td style="text-align:left;width: 0.5in; ">
9
</td>
<td style="text-align:left;width: 1.5in; ">
station
</td>
</tr>
<tr>
<td style="text-align:left;width: 0.5in; ">
43
</td>
<td style="text-align:left;width: 1.5in; ">
nt_10_poissonprocessintfunc
</td>
<td style="text-align:left;width: 0.5in; ">
10
</td>
<td style="text-align:left;width: 1.5in; ">
nt_10_poissonprocessintfunc
</td>
</tr>
<tr>
<td style="text-align:left;width: 0.5in; ">
44
</td>
<td style="text-align:left;width: 1.5in; ">
nt_20_poissonprocessintfunc
</td>
<td style="text-align:left;width: 0.5in; ">
11
</td>
<td style="text-align:left;width: 1.5in; ">
nt_20_poissonprocessintfunc
</td>
</tr>
<tr>
<td style="text-align:left;width: 0.5in; ">
45
</td>
<td style="text-align:left;width: 1.5in; ">
nt_50_poissonprocessintfunc
</td>
<td style="text-align:left;width: 0.5in; ">
12
</td>
<td style="text-align:left;width: 1.5in; ">
nt_50_poissonprocessintfunc
</td>
</tr>
<tr>
<td style="text-align:left;width: 0.5in; ">
46
</td>
<td style="text-align:left;width: 1.5in; ">
nt_100_poissonprocessintfunc
</td>
<td style="text-align:left;width: 0.5in; ">
13
</td>
<td style="text-align:left;width: 1.5in; ">
nt_100_poissonprocessintfunc
</td>
</tr>
<tr>
<td style="text-align:left;width: 0.5in; ">
47
</td>
<td style="text-align:left;width: 1.5in; ">
nt_250_poissonprocessintfunc
</td>
<td style="text-align:left;width: 0.5in; ">
14
</td>
<td style="text-align:left;width: 1.5in; ">
nt_250_poissonprocessintfunc
</td>
</tr>
<tr>
<td style="text-align:left;width: 0.5in; ">
48
</td>
<td style="text-align:left;width: 1.5in; ">
nt_500_poissonprocessintfunc
</td>
<td style="text-align:left;width: 0.5in; ">
15
</td>
<td style="text-align:left;width: 1.5in; ">
nt_500_poissonprocessintfunc
</td>
</tr>
<tr>
<td style="text-align:left;width: 0.5in; ">
49
</td>
<td style="text-align:left;width: 1.5in; ">
nt_700_poissonprocessintfunc
</td>
<td style="text-align:left;width: 0.5in; ">
16
</td>
<td style="text-align:left;width: 1.5in; ">
nt_700_poissonprocessintfunc
</td>
</tr>
<tr>
<td style="text-align:left;width: 0.5in; ">
50
</td>
<td style="text-align:left;width: 1.5in; ">
nt_1000_poissonprocessintfunc
</td>
<td style="text-align:left;width: 0.5in; ">
17
</td>
<td style="text-align:left;width: 1.5in; ">
nt_1000_poissonprocessintfunc
</td>
</tr>
<tr>
<td style="text-align:left;width: 0.5in; ">
51
</td>
<td style="text-align:left;width: 1.5in; ">
nt_1700_poissonprocessintfunc
</td>
<td style="text-align:left;width: 0.5in; ">
18
</td>
<td style="text-align:left;width: 1.5in; ">
nt_1700_poissonprocessintfunc
</td>
</tr>
<tr>
<td style="text-align:left;width: 0.5in; ">
52
</td>
<td style="text-align:left;width: 1.5in; ">
nt_3000_poissonprocessintfunc
</td>
<td style="text-align:left;width: 0.5in; ">
19
</td>
<td style="text-align:left;width: 1.5in; ">
nt_3000_poissonprocessintfunc
</td>
</tr>
<tr>
<td style="text-align:left;width: 0.5in; ">
53
</td>
<td style="text-align:left;width: 1.5in; ">
nt_7000_poissonprocessintfunc
</td>
<td style="text-align:left;width: 0.5in; ">
20
</td>
<td style="text-align:left;width: 1.5in; ">
nt_7000_poissonprocessintfunc
</td>
</tr>
</tbody>
</table>
<ol start="3" style="list-style-type: decimal">
<li>Enable access to PostgreSQL database with ISD stations information. See Annex <a href="D-dbstoring.html#dbstoring">D</a> <em><a href="D-dbstoring.html#dbstoring">Database Storing</a></em>. Connection information to the spatial database is shown in Table <a href="F-manual.html#tab:db">F.2</a>.</li>
</ol>
<table class="table" style="font-size: 8px; margin-left: auto; margin-right: auto;">
<caption style="font-size: initial !important;">
<span id="tab:db">Table F.2: </span>PostgreSQL Database Credentials
</caption>
<thead>
<tr>
<th style="text-align:left;text-align: left;">
Credential
</th>
<th style="text-align:left;text-align: left;">
Value
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;width: 0.8in; ">
dbname
</td>
<td style="text-align:left;width: 0.8in; ">
winddata
</td>
</tr>
<tr>
<td style="text-align:left;width: 0.8in; ">
host
</td>
<td style="text-align:left;width: 0.8in; ">
localhost
</td>
</tr>
<tr>
<td style="text-align:left;width: 0.8in; ">
pot
</td>
<td style="text-align:left;width: 0.8in; ">
5432
</td>
</tr>
<tr>
<td style="text-align:left;width: 0.8in; ">
user
</td>
<td style="text-align:left;width: 0.8in; ">
user1
</td>
</tr>
<tr>
<td style="text-align:left;width: 0.8in; ">
password
</td>
<td style="text-align:left;width: 0.8in; ">
user1
</td>
</tr>
</tbody>
</table>
<ol start="4" style="list-style-type: decimal">
<li><p>Be sure that <em>rlisd.xlsx</em> file is stored in same folder as <em>rl_700_nh.r</em> file, this is, <em>…/code/pot_pp/isd/maps/</em></p></li>
<li><p>Run file <em>rl_*_nh.r</em>, where * corresponds to the desired MRI year (10, 20, 50, 100, 250, 500, 700, 1000, 1700, 3000). For all the different geostatistical analysis implemented inside the file, the <em>spatial analysis expert</em> must review and interpret each partial result, and chose the best semivariance model and prediction map to use as final wind map.</p></li>
<li><p>Repeat previous step for all typical MRI</p></li>
</ol>
</div>
</div>
<div id="era5-1" class="section level3">
<h3><span class="header-section-number">F.3.2</span> ERA5</h3>


<p>Table  shows specific POT-PP R code used for ERA5 stations. Complete R code report can be found in Annex <a href="A-rcode.html#rcode">A</a> - Research R Code - Digital Files, Table .</p>
<p>Stations in ERA5 dataset correspond to its cell centers, from ID equal to 1 (top, left cell), counting next cells to the right, then bottom, up to 3381 (bottom, right cell). See Figure <a href="F-manual.html#fig:era5stations">F.1</a>.</p>
<div class="figure" style="text-align: center"><span id="fig:era5stations"></span>
<img src="thesis_files/figure-html/era5stations-1.png" alt="ERA5 Cells and Stations" width="672" />
<p class="caption">
Figure F.1: ERA5 Cells and Stations
</p>
</div>
<p><strong>Procedure to run POT-PP in ERA5 stations</strong>:</p>
<ol style="list-style-type: decimal">
<li><p>Install R version 3.6.2, RStudio Version 1.2.5033, and 60 R packages dependencies (see chunk of code at beginning of this manual)</p></li>
<li><p>Verify files and variables according to descriptions and recommendations of following list (from 1 to 2), then execute file <strong>pot_pp_era5.r</strong>.</p></li>
</ol>
<p>Files to run POT-PP in ERA5 stations are inside the folder <em>…/pot_pp/era5/</em>. Main file to run this process is <strong>pot_pp_era5.r</strong>, and inside it, next list of variables need to be configured.</p>
<ol style="list-style-type: decimal">
<li><em>inputpathnetcdf</em></li>
</ol>


<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb82-1" title="1">      inputpathnetcdf =<span class="st"> &quot;./data/&quot;</span></a></code></pre></div>

<p>Inside this folder <em>inputpathnetcdf</em>, file <em>“outfile_nc4c_zip9.nc”</em>, with variable 3-s wind gust <em>fg10</em>, must be stored. Be aware that ERA5 dataset does not need any type of standardization, as it comes standardized from source. See Annex <a href="C-datadownload.html#datadownload">C</a> for a detailed procedure to download ERA5 information from Climate Data Storage - CDS <a href="https://cds.climate.copernicus.eu/" class="uri">https://cds.climate.copernicus.eu/</a>.
2. <em>outputpath</em></p>


<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb83-1" title="1">      outputpath =<span class="st"> &quot;./era5/&quot;</span></a></code></pre></div>

<p>Variable <em>outputpath</em>, should point to the folder where all output files will be stored, after running POT-PP process. Following list describes main files to be generated, where <em>*</em> will be replaced by correspondent station ID.</p>
<ul>
<li><em>FittedModel_*.pdf</em>: ERA5 POT-PP output graphics. See Table .</li>
<li><em>fitted_model_result.xlsx</em>: Return levels ERA5 (all stations). See Table .</li>
<li><em>raw_data_station_*_fitted.xlsx</em>: ERA5 POT-PP output parameters by station. See Table .</li>
<li><em>raw_data_station_*_statistics.xlsx</em>: ERA5 POT-PP time (year, month, week) statistics by station. See Table .</li>
</ul>


<p>Table  shows <strong>input</strong> and <strong>output</strong> files for ERA5 stations, after running POT-PP. See Table  in Annex <a href="B-results.html#results">B</a> <em>Results - Digital Files</em> for a complete report of research files.</p>
<ol start="3" style="list-style-type: decimal">
<li>Linked R code</li>
</ol>
<p>Main file <strong>pot_pp_era5.r</strong>, runs supplemental code using the R command <em>source</em>. Be sure that all R code files listed in next chunk of code, are pointing to the right location. See Table  with the description of POT-PP ERA5 complementary R files. In Annex <a href="A-rcode.html#rcode">A</a> - Research R Code - Digital Files, Table  it is possible to see all R files related to this research.</p>


<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb84-1" title="1">    <span class="co">#Library of POT-PP functions, including Dr Adam Pintar R Code (not </span></a>
<a class="sourceLine" id="cb84-2" title="2">    <span class="co">#published because this is copyrighted)</span></a>
<a class="sourceLine" id="cb84-3" title="3">      <span class="kw">source</span>(<span class="st">&#39;./code/function_lib.R&#39;</span>)</a>
<a class="sourceLine" id="cb84-4" title="4">    <span class="co">#Raw Data (whole dataset) Statistics and Send to CSV </span></a>
<a class="sourceLine" id="cb84-5" title="5">      <span class="kw">source</span>(<span class="st">&#39;./code/stats_raw_data.r&#39;</span>)</a>
<a class="sourceLine" id="cb84-6" title="6">    <span class="co">#Non Thunderstorm - Create Raw Data Statistics and Send to CSV </span></a>
<a class="sourceLine" id="cb84-7" title="7">      <span class="kw">source</span>(<span class="st">&#39;./code/stats_raw_data_nt.r&#39;</span>)</a>
<a class="sourceLine" id="cb84-8" title="8">    <span class="co">#Thunderstorm - Create Raw Data Statistics and Send to CSV</span></a>
<a class="sourceLine" id="cb84-9" title="9">      <span class="kw">source</span>(<span class="st">&#39;./code/stats_raw_data_t.r&#39;</span>)</a>
<a class="sourceLine" id="cb84-10" title="10">    <span class="co">#Write &quot;t&quot; to csv, but changing to one data per day (the maximum)</span></a>
<a class="sourceLine" id="cb84-11" title="11">    <span class="co">#Write &quot;nt&quot; to csv, but changing to one data per day (the maximum)</span></a>
<a class="sourceLine" id="cb84-12" title="12">      <span class="kw">source</span>(<span class="st">&#39;./code/tnt_csv_1perday.r&#39;</span>)</a>
<a class="sourceLine" id="cb84-13" title="13">    <span class="co">#Statistics and graphics for de-clustered non-thunderstorm</span></a>
<a class="sourceLine" id="cb84-14" title="14">      <span class="kw">source</span>(<span class="st">&#39;./code/stats_graphs_dnt.r&#39;</span>)</a>
<a class="sourceLine" id="cb84-15" title="15">    <span class="co">#Statistics and graphics for de-clustered thunderstorm</span></a>
<a class="sourceLine" id="cb84-16" title="16">      <span class="kw">source</span>(<span class="st">&#39;./code/stats_graphs_dt.r&#39;</span>)</a>
<a class="sourceLine" id="cb84-17" title="17">    <span class="co">#Plots for thunderstorm</span></a>
<a class="sourceLine" id="cb84-18" title="18">      <span class="kw">source</span>(<span class="st">&#39;./code/plot_t.r&#39;</span>)</a>
<a class="sourceLine" id="cb84-19" title="19">    <span class="co">#Plots for non-thunderstorm</span></a>
<a class="sourceLine" id="cb84-20" title="20">      <span class="kw">source</span>(<span class="st">&#39;./code/plot_nt.r&#39;</span>)</a>
<a class="sourceLine" id="cb84-21" title="21">    <span class="co">#Plots for non-thunderstorm and thunderstorm</span></a>
<a class="sourceLine" id="cb84-22" title="22">      <span class="kw">source</span>(<span class="st">&#39;./code/plot_t_nt.r&#39;</span>)</a></code></pre></div>


</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="E-docrcode.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": [["thesis.pdf", "PDF"], ["thesis.epub", "EPUB"], ["thesis.docx", "Word"]],
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
