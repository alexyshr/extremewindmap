`r if(knitr:::is_latex_output()) '\\appendix'`

`r if(!knitr:::is_latex_output()) '# (APPENDIX) Appendix {-}'` 

<!--
If you feel it necessary to include an appendix, it goes here.
-->

# Research R Code - Digital Files {#rcode}

```{r code, echo=FALSE, message=FALSE, warning=FALSE, paged.print=TRUE, results="asis"}
library(knitr)
library(kableExtra)
code <-read.csv("./data/results_annex/code.csv",header=TRUE, stringsAsFactors = F) 


mylink_markdown <- paste0("[", code[,1], "](", code[,3], ")")
mylink_latex <-  paste0("\\href{", code[,3], "}{", code[,1], "}")
#mylink_latex <-  paste0("\\href{", code[,3], "}{a}"
#mytable_markdown <- cbind(folder_Tree = mylink_markdown, description = code[,2])

mytable_latex <- cbind(folderTree = mylink_latex, description = code[,2])


kable(mytable_latex, linesep = "", align=rep('l', 2), format = "latex", escape = FALSE, #format = "markdown",
       col.names = c("Folder Tree - Ftp Links","Description"),
       caption = "Research R Code. \\href{ftp://ftp.geocorp.co/windthesis/}{ftp://ftp.geocorp.co/windthesis/}. User anonymous@geocorp.co (no password).",
       caption.short = "code",
       longtable = TRUE,
       booktabs = TRUE) %>%
       row_spec(0, align = "l") %>%
       column_spec(1,width = "1.3in") %>%
       column_spec(2,width = "4.9in") %>%
#       column_spec(3,width = "0.5in") %>%
       kable_styling(font_size = 7, latex_options=c("scale_down")) #%>%
#       #add_header_above(c(" ", "Raw Data" = 4, "Declustered Data" = 4))

# library(dplyr)
# library(knitr)
# library(kableExtra)
# dt_url <- c("https://en.wikipedia.org/wiki/Cadillac_Fleetwood",
#             "https://www.lincoln.com/luxury-cars/continental/",
#             "http://shop.honda.com/civics.aspx",
#             "https://bringatrailer.com/2011/12/28/striking-1973-maserati-bora-4-9/")

#results_structure[,1:2] %>%
# mutate (FolderTree = cell_spec(FolderTree, "html", link = Ftp)) %>%
# kable("html", escape = FALSE, format = "markdown") %>%
# kable_styling(bootstrap_options = c("hover", "condensed"))
   
   
   
# mtcars[c(15,16,19,31),1:3] %>% 
#   mutate(model = cell_spec(row.names(.), "html", link = dt_url)) %>%
#   kable("html", escape = FALSE) %>%
#   kable_styling(bootstrap_options = c("hover", "condensed"))

```

# Resutls - Digital Files {#results}


```{r resultsstructure, echo=FALSE, message=FALSE, warning=FALSE, paged.print=TRUE, results="asis"}
library(knitr)
library(kableExtra)
results_structure <-read.csv("./data/results_annex/results_structure.csv",header=TRUE, stringsAsFactors = F) 
#Ftp = results_structure[,3]

mylink_markdown <- paste0("[", results_structure[,1], "](", results_structure[,3], ")")
#mylink_latex <-  paste0("\\href{", results_structure[,3], "}{\verb", knitr::asis_output("\U007C"), results_structure[,1], knitr::asis_output("\U007C"), "}")
mylink_latex <-  paste0("\\href{", results_structure[,3], "}{", results_structure[,1], "}")
#mylink_latex <-  paste0("\\href{", results_structure[,3], "}{a}"
#mytable_markdown <- cbind(folder_Tree = mylink_markdown, description = results_structure[,2])

mytable_latex <- cbind(folderTree = mylink_latex, description = results_structure[,2])


kable(mytable_latex, linesep = "", align=rep('l', 2), format = "latex", escape = FALSE, #format = "markdown",
       col.names = c("Folder Tree - Ftp Links","Description"),
       caption = "Results. Digital files in FTP site \\href{ftp://ftp.geocorp.co/windthesis/}{ftp://ftp.geocorp.co/windthesis/}. User anonymous@geocorp.co (no password).",
       caption.short = "digital files",
       longtable = TRUE,
       booktabs = TRUE) %>%
       row_spec(0, align = "l") %>%
       column_spec(1,width = "2.2in") %>%
       column_spec(2,width = "4in") %>%
#       column_spec(3,width = "0.5in") %>%
       kable_styling(font_size = 8, latex_options=c("scale_down")) #%>%
#       #add_header_above(c(" ", "Raw Data" = 4, "Declustered Data" = 4))

# library(dplyr)
# library(knitr)
# library(kableExtra)
# dt_url <- c("https://en.wikipedia.org/wiki/Cadillac_Fleetwood",
#             "https://www.lincoln.com/luxury-cars/continental/",
#             "http://shop.honda.com/civics.aspx",
#             "https://bringatrailer.com/2011/12/28/striking-1973-maserati-bora-4-9/")



#results_structure[,1:2] %>%
# mutate (FolderTree = cell_spec(FolderTree, "html", link = Ftp)) %>%
# kable("html", escape = FALSE, format = "markdown") %>%
# kable_styling(bootstrap_options = c("hover", "condensed"))
   
   
   
# mtcars[c(15,16,19,31),1:3] %>% 
#   mutate(model = cell_spec(row.names(.), "html", link = dt_url)) %>%
#   kable("html", escape = FALSE) %>%
#   kable_styling(bootstrap_options = c("hover", "condensed"))

```


```{r nice-tab, tidy=FALSE,echo=FALSE,message=FALSE} 
# library(dplyr)
# library(kableExtra)
# library(rmarkdown)
# library(knitr)
# df<-data.frame(name = rep("linkname",10))
# url<- c("https://en.wikipedia.org/wiki/Cadillac_Fleetwood",
#        "https://www.lincoln.com/luxury-cars/continental/",
#        "http://shop.honda.com/civics.aspx",
#        "https://bringatrailer.com/2011/12/28/striking-1973-maserati-bora-4-9/",
#        "https://en.wikipedia.org/wiki/Cadillac_Fleetwood",
#        "https://www.lincoln.com/luxury-cars/continental/",
#        "http://shop.honda.com/civics.aspx",
#        "https://bringatrailer.com/2011/12/28/striking-1973-maserati-bora-4-9/",
#        "https://en.wikipedia.org/wiki/Cadillac_Fleetwood",
#        "https://www.lincoln.com/luxury-cars/continental/")
# 
# df$name <- paste0("[", df$name, "](", url, ")")
# 
# knitr::kable(df, format = "markdown")
# 
# x <- cars[1:3,]
# urls <- c("stackoverflow.com", "stats.stackexchange.com", "homebrew.stackexchange.com")
# linkID <- c("link1", "link2", "link3")
# x$website <- paste0("[", linkID, "](http://", urls, ")")
# sections<-c("rmd-results","rmd-results","rmd-results")
# section_links<-paste0("\\\\@ref(",sections,")")
# fig <-c("ingeniarmaps","ingeniarmaps","ingeniarmaps")
# fig_links<-paste0("\\\\@ref(fig:",sections,")")
# x$my_fig = paste0("[", linkID, "](#",fig,")")
# x$my_sections<-paste0("[", linkID, "](#",sections,")")
# knitr::kable(x, caption = 'Example table', booktabs = TRUE, format = "markdown")


```

```{r rawdatastationidfitted, echo=FALSE, message=FALSE, warning=FALSE, paged.print=TRUE, results="asis"}
library(knitr)
library(kableExtra)
rawdatastationidfitted <-read.csv("./data/results_annex/raw_data_station_id_fitted.csv",header=TRUE, stringsAsFactors = F) 


kable(rawdatastationidfitted, linesep = "", align=rep('l', 3), #format = "markdown",
       col.names = c("Excel Sheet Name","Description","Important"),
       caption = "Content of the output Excel Book 'raw\\_data\\_station\\_*\\_fitted.xlsx', where '*' is replaced by the Station ID. One file by station.",
       caption.short = "rawdatastationidfitted",
       longtable = TRUE,
       booktabs = TRUE) %>%
       row_spec(0, align = "l") %>%
       column_spec(1,width = "1.5in") %>%
       column_spec(2,width = "3in") %>%
       column_spec(3,width = "1.5in") %>%
       kable_styling(font_size = 8, latex_options=c("scale_down")) #%>%
```

```{r rawdatastationidstatistics, echo=FALSE, message=FALSE, warning=FALSE, paged.print=TRUE, results="asis"}
library(knitr)
library(kableExtra)
rawdatastationidstatistics <-read.csv("./data/results_annex/raw_data_station_id_statistics.csv",header=TRUE, stringsAsFactors = F) 


kable(rawdatastationidstatistics, linesep = "", align=rep('l', 2), #format = "markdown",
       col.names = c("Excel Sheet Name","Description"),
       caption = "Content of the output Excel Book 'raw\\_data\\_station\\_*\\_statistics.xlsx', where '*' is replaced by the Station ID. One file by station.",
       caption.short = "rawdatastationidstatistics",
       longtable = TRUE,
       booktabs = TRUE) %>%
       row_spec(0, align = "l") %>%
       column_spec(1,width = "1.2in") %>%
       column_spec(2,width = "4.6in") %>%
       #column_spec(3,width = "1.5in") %>%
       kable_styling(font_size = 8, latex_options=c("scale_down")) #%>%
```

```{r fittedmodelidpdf, echo=FALSE, message=FALSE, warning=FALSE, paged.print=TRUE, results="asis"}
library(knitr)
library(kableExtra)
fittedmodelidpdf <-read.csv("./data/results_annex/fittedmodel_id_pdf.csv",header=TRUE, stringsAsFactors = F) 


kable(fittedmodelidpdf, linesep = "", align=rep('l', 2), #format = "markdown",
       col.names = c("Graphic","Description"),
       caption = "Content of the output graphics PDF file 'FittedModel\\_*.pdf', where '*' is replaced by the Station ID. One file by station.",
       caption.short = "fittedmodelidpdf",
       longtable = TRUE,
       booktabs = TRUE) %>%
       row_spec(0, align = "l") %>%
       column_spec(1,width = "0.4in") %>%
       column_spec(2,width = "5.7in") %>%
       #column_spec(3,width = "1.5in") %>%
       kable_styling(font_size = 8, latex_options=c("scale_down")) #%>%
```



```{r returnlevels, echo=FALSE, message=FALSE, warning=FALSE, paged.print=TRUE, results="asis"}
library(knitr)
library(kableExtra)
returnlevels <-read.csv("./data/results_annex/return_levels.csv",header=TRUE, stringsAsFactors = F) 


kable(returnlevels, linesep = "", align=rep('l', 4), #format = "markdown",
       col.names = c("Column ID", "Columns Name", "Important", "Description"),
       caption = "Content of the output Excel Book 'fitted\\_model\\_result.xlsx' (sheet pp\\_pintar). One file by dataset (ISD, ERA5).",
       caption.short = "returnlevels",
       longtable = TRUE,
       booktabs = TRUE) %>%
       row_spec(0, align = "l") %>%
       column_spec(1,width = "0.6in") %>%
       column_spec(2,width = "1.6in") %>%
       column_spec(3,width = "1in") %>%
       column_spec(4,width = "2.5in") %>%
       kable_styling(font_size = 8, latex_options=c("scale_down")) #%>%
```



```{r era5maps, echo=FALSE, message=FALSE, warning=FALSE, paged.print=TRUE, results="asis"}
library(knitr)
library(kableExtra)
era5maps <-read.csv("./data/results_annex/ERA5_maps.csv",header=TRUE, stringsAsFactors = F) 


kable(era5maps, linesep = "", align=rep('l', 2), #format = "markdown",
       col.names = c("File", "Description"),
       caption = "ERA5 output maps",
       caption.short = "era5maps",
       longtable = TRUE,
       booktabs = TRUE) %>%
       row_spec(0, align = "l") %>%
       column_spec(1,width = "2in") %>%
       column_spec(2,width = "3.6in") %>%
       #column_spec(3,width = "1in") %>%
       #column_spec(4,width = "2.5in") %>%
       kable_styling(font_size = 8, latex_options=c("scale_down")) #%>%
```

```{r isdmaps, echo=FALSE, message=FALSE, warning=FALSE, paged.print=TRUE, results="asis"}
library(knitr)
library(kableExtra)
isdmaps <-read.csv("./data/results_annex/ISD_maps.csv",header=TRUE, stringsAsFactors = F) 


kable(isdmaps, linesep = "", align=rep('l', 2), #format = "markdown",
       col.names = c("File", "Description"),
       caption = "ISD output maps",
       caption.short = "isdmaps",
       longtable = TRUE,
       booktabs = TRUE) %>%
       row_spec(0, align = "l") %>%
       column_spec(1,width = "2in") %>%
       column_spec(2,width = "3.5in") %>%
       #column_spec(3,width = "1in") %>%
       #column_spec(4,width = "2.5in") %>%
       kable_styling(font_size = 8, latex_options=c("scale_down")) #%>%
```

# ERA5 Data Download and Integration {#era5download}

The European Centre for Medium-Range Weather Forecasts - ECMWF had implemented the Climate Data Storage - CDS <https://cds.climate.copernicus.eu/>, where all its datasets can be downloaded, however there is a straightforward way to get ERA5 data throught Python library CDSAPI. Before to usde CDSAPI, it is neccesary to research about names and meanings of ERA5 variables using the official _data documentation_ web page <https://confluence.ecmwf.int/display/CKB/ERA5%3A+data+documentation>, or the _parameter database_ <https://apps.ecmwf.int/codes/grib/param-db>, that includes all ECWMF datasourses, not only ERA5.

Next block of code shows the use of CDSAPI (Python) to download ERA5 variable _10fg - 10 meters wind gust_, from 1979 to 1991 for Colombia area. The most important keywords there, allow to define ERA5 datasource and product type, variable name _'variable'_, format netCDF _'format'_, area of interest _'area'_, using WGS88 coordinates in the format _north, west, south, east_, cell size _'grid'_ in decimal degrees, and all the keywords related to time _'year'_, _'month'_, _'day'_, _'time'_. 


```
      import cdsapi
      c = cdsapi.Client()
      c.retrieve(
      'reanalysis-era5-single-levels',
      {
         'product_type':'reanalysis',
         'format':'netcdf',
         'variable':'10m_wind_gust_since_previous_post_processing',
         'year':[
             '1979','1980','1981',
             '1982','1983','1984',
             '1985','1986','1987',
             '1988','1989','1990',
             '1991'
         ],
         'month':[
             '01','02','03',
             '04','05','06',
             '07','08','09',
             '10','11','12'
         ],
         'time':[
             '00:00','01:00','02:00',
             '03:00','04:00','05:00',
             '06:00','07:00','08:00',
             '09:00','10:00','11:00',
             '12:00','13:00','14:00',
             '15:00','16:00','17:00',
             '18:00','19:00','20:00',
             '21:00','22:00','23:00'
         ],
         'day':[
             '01','02','03',
             '04','05','06',
             '07','08','09',
             '10','11','12',
             '13','14','15',
             '16','17','18',
             '19','20','21',
             '22','23','24',
             '25','26','27',
             '28','29','30',
             '31'
         ],
         'area':[12.5, -79.1, -4.5, -66.8], # North, West, South, East.
         'grid':[0.25,0.25]
      },
      '10fg_1979_1991_netcdf_.25x.25.nc')
```

Next Table \@ref(tab:pythonera5), shows all Python scripts used to download variables _10fg - 10 meters wind gust_ and _fsr - forecast surface roughness_, for the study area, along the period 1979 to 2019. Last file in the table, hold a summary of commands to manipulate NetCDF files.

After downloading separate netCDF files, there are different tools available, to manipulate them, for instante Climate Data Operators - CDO <https://code.mpimet.mpg.de/projects/cdo/>, NetCDF command line utilies <https://www.unidata.ucar.edu/software/netcdf/docs/netcdf_working_with_netcdf_files.html>, and NetCDF operator - NCO <http://nco.sourceforge.net/>.

```{r pythonera5, echo=FALSE, message=FALSE, warning=FALSE, paged.print=TRUE, results="asis"}
library(knitr)
library(kableExtra)
pythonera5 <-read.csv("./data/results_annex/downloadingera5.csv",header=TRUE, stringsAsFactors = F) 

mylink_markdown <- paste0("[", pythonera5[,1], "](", pythonera5[,3], ")")
mylink_latex <-  paste0("\\href{", pythonera5[,3], "}{", pythonera5[,1], "}")
mytable_latex <- cbind(folderTree = mylink_latex, description = pythonera5[,2])

kable(mytable_latex, linesep = "", align=rep('l', 2), format = "latex", escape = FALSE, #format = "markdown",
       col.names = c("Folder Tree - Ftp Links","Description"),
       caption = "Python Scripts to download ERA5 data, and commands to join netCDF files.  \\href{ftp://ftp.geocorp.co/windthesis/}{ftp://ftp.geocorp.co/windthesis/}. User anonymous@geocorp.co (no password).",
       caption.short = "pythonera5",
       longtable = TRUE,
       booktabs = TRUE) %>%
       row_spec(0, align = "l") %>%
       column_spec(1,width = "2.3in") %>%
       column_spec(2,width = "3in") %>%
       kable_styling(font_size = 8, latex_options=c("scale_down")) #%>%
```


Next CDO command, will join by time all netCDF files inside a folder, where _-f_ defines the file format, _-b_ defines the data format, and _-z_ defines the compression level (from 1 to 9). The resulting file name is _outfile_nc4c_zip9.nc_. Then whit _cdo griddes_ is possible to review output file content.


```
      cdo -f nc4c -b F32 -z zip_9 mergetime *.nc outfile_nc4c_zip9.nc
      cdo griddes outfile_nc4c_zip9.nc
```

Using NetCDF command line utilities, next commands will explore the content of a file, and change file format.


```
      ncdump -h file.nc
      nccopy -k 'nc4' -d 9 file.nc file_d9.nc
```

In Linux, next NCO commands will extract variable p0001 from file.nc to p0001.nc, rename variables p0001 to fsr in file p0001.nc, and view the result.


```
      ncks -v p0001 file.nc p0001.nc
      ncrename -v p0001,fsr p0001.nc
      ncview p0001.nc
```

# Thesis Document R Code {#docrcode}

```{r}
library(knitr)
opts_chunk$set(tidy.opts=list(width.cutoff=60),tidy=TRUE)
```


This appendix includes all of the R chunks of code that were hidden throughout the document (using the `include = FALSE` or `echo=FALSE, message=FALSE, warning=FALSE` chunks tag) to help with readability and/or setup.

**In Chapter \@ref(rmd-data) - Data:**

1. Install/Load Packages

```{r ref.label=c('load_pkgs'), results='hide', echo = TRUE, eval=FALSE}
```

2. Load and Plot ISD and IDEAM Stations

```{r ref.label=c('loadstations', 'sfideam', 'plotideamstations', 'plotoneideamstation'), results='hide', echo = TRUE, eval=FALSE}
```

**In Chapter \@ref(rmd-thefra):**


```{r ref.label='plotgumbelpdffunction', results='hide', echo = TRUE, eval=FALSE}
```

# User Manual {#manual}

One complete example will be shown here to run the entire process from the beginning (data standardization), to the end (wind map creation and final map creation), using ISD station XXXXX.



